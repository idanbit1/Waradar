<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WARADAR - Strategic Risk Monitor</title>
    <style>
        :root {
            --primary: #00ff41; /* Cyber Green */
            --warning: #ffb700; /* Alert Orange */
            --danger: #ff3333;  /* War Red */
            --bg: #050505;      /* Void Black */
            --panel: #0f1215;
            --text-dim: #888;
            --modal-bg: rgba(10, 15, 10, 0.95);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            background-color: var(--bg);
            color: var(--primary);
            font-family: 'Segoe UI', 'Roboto Mono', monospace;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Scanline Overlay */
        body::after {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);
            pointer-events: none;
            z-index: 990;
        }

        /* --- HEADER --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(0, 20, 0, 0.9);
            border-bottom: 1px solid var(--primary);
            backdrop-filter: blur(5px);
            z-index: 1000;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .radar-logo {
            width: 40px;
            height: 40px;
            border: 2px solid var(--primary);
            border-radius: 50%;
            position: relative;
            background: radial-gradient(circle, rgba(0,255,65,0.1), transparent);
        }

        .radar-sweep {
            position: absolute;
            width: 50%;
            height: 50%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 65, 0.5));
            top: 0; left: 0;
            transform-origin: bottom right;
            animation: sweep 2s infinite linear;
            border-radius: 100% 0 0 0;
        }

        @keyframes sweep { to { transform: rotate(360deg); } }

        .title-group h1 { margin: 0; font-size: 1.5rem; letter-spacing: 2px; text-transform: uppercase; }
        .live-tag { font-size: 0.7rem; background: var(--danger); color: white; padding: 2px 5px; border-radius: 3px; animation: blink 1s infinite; }

        .top-controls { display: flex; gap: 15px; align-items: center; }
        .clock { font-family: 'Courier New', monospace; font-weight: bold; font-size: 1.1rem; display: none; }
        @media(min-width: 600px) { .clock { display: block; } }

        .lang-flags { display: flex; gap: 10px; cursor: pointer; }
        .flag { font-size: 1.5rem; filter: grayscale(1); transition: 0.3s; }
        .flag:hover, .flag.active { filter: grayscale(0); transform: scale(1.2); }

        .donate-btn {
            background: #FFDD00; color: #000; text-decoration: none; padding: 5px 10px;
            font-weight: bold; border-radius: 4px; display: flex; align-items: center; gap: 5px; font-size: 0.8rem;
            border: 1px solid #cca300; transition: 0.3s;
        }
        .donate-btn:hover { background: #ffe600; box-shadow: 0 0 10px #FFDD00; }

        /* --- MAIN GRID --- */
        main {
            flex: 1;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        @media (max-width: 900px) { main { grid-template-columns: 1fr; } }

        .card {
            background: var(--panel);
            border: 1px solid #333;
            padding: 20px;
            border-radius: 4px;
            position: relative;
        }
        .card h2 {
            margin-top: 0;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
            font-size: 1.1rem;
            color: var(--text-dim);
            text-transform: uppercase;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Info Icon Style */
        .info-icon {
            display: inline-flex; align-items: center; justify-content: center;
            width: 18px; height: 18px; border: 1px solid var(--text-dim);
            color: var(--text-dim); border-radius: 50%; font-size: 0.7rem;
            cursor: pointer; margin-left: 8px; transition: 0.2s;
        }
        .info-icon:hover { color: var(--primary); border-color: var(--primary); box-shadow: 0 0 5px var(--primary); }

        /* --- BIG SCORE GAUGE --- */
        .score-container { text-align: center; padding: 20px; }
        .big-score {
            font-size: 6rem; font-weight: 900; color: var(--primary);
            text-shadow: 0 0 20px rgba(0,255,65,0.4);
        }

        /* --- PARAMETERS --- */
        .parameter-row { margin-bottom: 18px; }
        .param-header { display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 0.9rem; align-items: center; }
        .param-label { display: flex; align-items: center; }
        .progress-bg { background: #222; height: 8px; width: 100%; border-radius: 4px; overflow: hidden; }
        .progress-fill {
            height: 100%; width: 0%;
            background: linear-gradient(90deg, var(--primary), var(--warning));
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(3px);
            z-index: 2000; display: none; align-items: center; justify-content: center;
        }
        .modal-overlay.open { display: flex; }
        
        .modal-box {
            background: var(--panel); border: 1px solid var(--primary);
            width: 90%; max-width: 500px; padding: 25px;
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.2);
            position: relative; animation: slideIn 0.3s ease;
        }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .modal-close {
            position: absolute; top: 10px; right: 15px;
            font-size: 1.5rem; cursor: pointer; color: var(--text-dim);
        }
        .modal-close:hover { color: var(--primary); }
        
        .modal-title { font-size: 1.2rem; color: var(--primary); border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; }
        .modal-content { font-size: 0.9rem; line-height: 1.6; color: #ddd; }
        .modal-content strong { color: var(--warning); }
        .modal-tag { display: inline-block; background: #222; padding: 2px 6px; border-radius: 3px; font-size: 0.75rem; color: #888; margin-top: 10px; border: 1px solid #444; }

        /* --- FOOTER --- */
        footer {
            text-align: center; padding: 20px; font-size: 0.8rem; color: #555;
            border-top: 1px solid #222; margin-top: auto; display: flex; flex-direction: column; gap: 10px;
        }
        .share-btn {
            background: transparent; border: 1px solid var(--primary); color: var(--primary);
            padding: 8px 20px; cursor: pointer; font-family: inherit; margin: 10px auto;
            display: inline-flex; align-items: center; gap: 8px; transition: 0.3s;
        }
        .share-btn:hover { background: rgba(0, 255, 65, 0.1); box-shadow: 0 0 10px rgba(0, 255, 65, 0.2); }

        .blink { animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        .rtl { direction: rtl; }
        .rtl .info-icon { margin-left: 0; margin-right: 8px; }
    </style>
</head>
<body>

    <header>
        <div class="brand">
            <div class="radar-logo"><div class="radar-sweep"></div></div>
            <div class="title-group">
                <h1>WARADAR <span class="live-tag">LIVE</span></h1>
            </div>
        </div>

        <div class="top-controls">
            <div class="clock" id="clock">00:00:00</div>
            
            <a href="https://buymeacoffee.com/idanbit1" target="_blank" class="donate-btn">
                <span>â˜•</span> <span data-key="donate">Donate</span>
            </a>

            <div class="lang-flags">
                <span class="flag active" onclick="setLang('en')" title="English">ğŸ‡ºğŸ‡¸</span>
                <span class="flag" onclick="setLang('he')" title="×¢×‘×¨×™×ª">ğŸ‡®ğŸ‡±</span>
                <span class="flag" onclick="setLang('ru')" title="Ğ ÑƒÑÑĞºĞ¸Ğ¹">ğŸ‡·ğŸ‡º</span>
            </div>
        </div>
    </header>

    <main>
        <div class="card">
            <h2>
                <span data-key="escalation_probability">TOTAL RISK SCORE</span>
                <span class="info-icon" onclick="openModal('general')">?</span>
            </h2>
            <div class="score-container">
                <div class="big-score" id="mainScore">--%</div>
                <div style="font-size: 1.2rem; margin-top: 10px;">
                    <span data-key="status">RISK LEVEL:</span> 
                    <span id="statusText" style="color: var(--warning)">CALCULATING...</span>
                </div>
                <div style="font-size: 0.8rem; color: #666; margin-top: 20px;">
                    <span data-key="last_update">LAST UPDATE:</span> <span id="lastUpdate">Checking...</span>
                </div>
                <div id="multiplierBadge" style="display:none; margin-top:15px; color: var(--danger); font-size: 0.8rem; border: 1px solid var(--danger); padding: 5px; display: inline-block;">
                    âš  ESCALATION MULTIPLIER ACTIVE (+15%)
                </div>
            </div>
        </div>

        <div class="card">
            <h2 data-key="risk_parameters">LIVE SIGNALS</h2>
            <div id="parametersList">
                </div>
        </div>
    </main>

    <div class="modal-overlay" id="infoModal" onclick="closeModal(event)">
        <div class="modal-box">
            <span class="modal-close" onclick="closeModal(event, true)">&times;</span>
            <div class="modal-title" id="mTitle">Title</div>
            <div class="modal-content" id="mContent">Content</div>
        </div>
    </div>

    <footer>
        <div>
            <button class="share-btn" onclick="shareSite()">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M13.5 1a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5zm-8.5 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm11 5.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3z"/></svg>
                <span data-key="share">Share</span>
            </button>
        </div>
        <div class="disclaimer-box" style="opacity: 0.7;">
            <span data-key="disclaimer_short">Open-source intel. Not official military advice.</span>
        </div>
        <div style="margin-top: 10px; color: #444;">
            Created by <strong style="color: #666;">Idan Biton</strong>
        </div>
    </footer>

    <script>
        // --- DATA & CONTENT ---
        // Configuration of the 6 signals
        const signalsConfig = [
            { id: 'news', weight: 0.25, baseVal: 45 },
            { id: 'aviation', weight: 0.20, baseVal: 30 },
            { id: 'tankers', weight: 0.15, baseVal: 65 },
            { id: 'market', weight: 0.20, baseVal: 55 },
            { id: 'pentagon', weight: 0.10, baseVal: 20 },
            { id: 'weather', weight: 0.10, baseVal: 80 }
        ];

        // Text Content
        const content = {
            en: {
                donate: "Donate",
                escalation_probability: "TOTAL RISK SCORE",
                status: "RISK LEVEL:",
                last_update: "LAST UPDATE:",
                risk_parameters: "LIVE SIGNALS",
                share: "SHARE",
                disclaimer_short: "Statistical data only. Use at your own discretion.",
                
                // Labels
                l_news: "News Intelligence",
                l_aviation: "Civil Aviation",
                l_tankers: "Military Tankers",
                l_market: "Prediction Markets",
                l_pentagon: "Pentagon Activity",
                l_weather: "Weather (Tehran)",

                // Modal Content (Exact Text from Prompt)
                m_general_title: "How We Calculate Risk",
                m_general_desc: `
                    <strong>Total Risk = Weighted Sum of 6 Signals</strong><br><br>
                    â€¢ <strong>News Intel (25%):</strong> Breaking news with critical keywords increases risk.<br>
                    â€¢ <strong>Civil Aviation (20%):</strong> Fewer flights over Iran = airlines avoiding = higher risk.<br>
                    â€¢ <strong>Military Tankers (15%):</strong> More US tankers in the region = higher risk.<br>
                    â€¢ <strong>Market Odds (20%):</strong> Prediction market betting odds for strike within 7 days.<br>
                    â€¢ <strong>Pentagon Activity (10%):</strong> Unusual late-night activity near Pentagon = higher risk.<br>
                    â€¢ <strong>Weather (10%):</strong> Clear skies in Tehran = favorable for operations = higher risk.<br><br>
                    <strong>Escalation Multiplier:</strong> If 3+ signals are elevated (>30%), total gets a 15% boost.<br><br>
                    <strong>Risk Levels:</strong><br>
                    â€¢ 0-30% = Low<br>
                    â€¢ 31-60% = Elevated<br>
                    â€¢ 61-85% = High
                `,
                m_news_desc: `
                    Scans BBC World and Al Jazeera for Iran-related news.<br><br>
                    <strong>What we look for:</strong> Headlines containing "strike", "attack", "military", "missile", "war", "imminent"<br><br>
                    <strong>How it works:</strong> More critical articles = higher risk. The ratio of alarming headlines to total coverage drives the score.<br>
                    <div class="modal-tag">Weight: 25%</div>
                `,
                m_aviation_desc: `
                    Tracks commercial flights over Iranian airspace via OpenSky Network.<br><br>
                    <strong>Why it matters:</strong> Airlines avoid conflict zones. When flights drop, it often signals that carriers have intelligence suggesting danger.<br><br>
                    <strong>How it works:</strong> Fewer aircraft = higher risk. Normal traffic (~100+ planes) = low risk.<br>
                    <div class="modal-tag">Weight: 20%</div>
                `,
                m_tankers_desc: `
                    Monitors US Air Force refueling aircraft in the Middle East.<br><br>
                    <strong>Why it matters:</strong> Tankers (KC-135, KC-46) enable fighters and bombers to operate far from base. A surge in tanker activity often precedes military operations.<br><br>
                    <strong>How it works:</strong> More tankers detected = higher risk.<br>
                    <div class="modal-tag">Weight: 15%</div>
                `,
                m_pentagon_desc: `
                    Monitors activity patterns near the Pentagon.<br><br>
                    <strong>Why it matters:</strong> Unusual late-night or weekend activity can indicate crisis planning sessions.<br><br>
                    <strong>How it works:</strong> Normal business hours = low risk. Elevated activity at odd hours = higher risk.<br>
                    <div class="modal-tag">Weight: 10%</div>
                `,
                m_market_desc: `
                    Real-money betting odds on "US or Israel strike Iran" within 7 days.<br>
                    Source: Polymarket<br><br>
                    <strong>Why it matters:</strong> When people bet real money, they research carefully. Market odds aggregate the wisdom of thousands of informed traders.<br>
                    <div class="modal-tag">Weight: 20%</div>
                `,
                m_weather_desc: `
                    Current weather in Tehran, Iran.<br><br>
                    <strong>Why it matters:</strong> Military operations favor clear skies for visibility and precision targeting. Poor weather provides natural cover.<br><br>
                    <strong>How it works:</strong> Clear skies = higher risk. Cloudy/poor visibility = lower risk.<br>
                    <div class="modal-tag">Weight: 10%</div>
                `
            },
            he: {
                donate: "×ª×¨×•××”",
                escalation_probability: "×¦×™×•×Ÿ ×¡×™×›×•×Ÿ ×›×•×œ×œ",
                status: "×¨××ª ×¡×™×›×•×Ÿ:",
                last_update: "×¢×“×›×•×Ÿ ××—×¨×•×Ÿ:",
                risk_parameters: "××•×ª×•×ª ×—×™×™×",
                share: "×©×ª×£",
                disclaimer_short: "× ×ª×•× ×™× ×¡×˜×˜×™×¡×˜×™×™× ×‘×œ×‘×“. ×”×©×™××•×© ×‘××—×¨×™×•×ª×š.",
                
                l_news: "××•×“×™×¢×™×Ÿ ×—×“×©×•×ª×™",
                l_aviation: "×ª×¢×•×¤×” ××–×¨×—×™×ª",
                l_tankers: "××›×œ×™×•×ª ×¦×‘××™×•×ª",
                l_market: "×©×•×§×™ ×—×™×–×•×™",
                l_pentagon: "×¤×¢×™×œ×•×ª ×‘×¤× ×˜×’×•×Ÿ",
                l_weather: "××–×’ ××•×•×™×¨ (×˜×”×¨×Ÿ)",

                m_general_title: "×›×™×¦×“ ×× ×• ××—×©×‘×™× ×¡×™×›×•×Ÿ?",
                m_general_desc: `
                    <strong>×¡×™×›×•×Ÿ ×›×•×œ×œ = ×©×§×œ×•×œ ×©×œ 6 ××•×ª×•×ª</strong><br><br>
                    â€¢ <strong>×—×“×©×•×ª (25%):</strong> ××™×œ×•×ª ××¤×ª×— ×§×¨×™×˜×™×•×ª ×‘×›×•×ª×¨×•×ª.<br>
                    â€¢ <strong>×ª×¢×•×¤×” (20%):</strong> ×¤×—×•×ª ×˜×™×¡×•×ª ××¢×œ ××™×¨××Ÿ = ×¡×™×›×•×Ÿ ×’×‘×•×”.<br>
                    â€¢ <strong>××›×œ×™×•×ª (15%):</strong> ×¨×™×‘×•×™ ××ª×“×œ×§×™× ×××¨×™×§××™× ×‘××–×•×¨.<br>
                    â€¢ <strong>×©×•×§×™ ×—×™×–×•×™ (20%):</strong> ×™×—×¡×™ ×”×™××•×¨×™× ×¢×œ ×ª×§×™×¤×” ×‘-7 ×™××™×.<br>
                    â€¢ <strong>×¤× ×˜×’×•×Ÿ (10%):</strong> ×¤×¢×™×œ×•×ª ×œ×™×œ×™×ª ×—×¨×™×’×” ×‘××˜×” ××¨×”×´×‘.<br>
                    â€¢ <strong>××–×’ ××•×•×™×¨ (10%):</strong> ×©××™×™× × ×§×™×™× ×‘×˜×”×¨×Ÿ = × ×•×— ×œ×ª×§×™×¤×”.<br><br>
                    <strong>××›×¤×™×œ ××¡×§×œ×¦×™×”:</strong> ×× 3+ ××“×“×™× ×’×‘×•×”×™×, ×”×¦×™×•×Ÿ ××§×‘×œ ×‘×•× ×•×¡ 15%.
                `,
                m_news_desc: "×¡×¨×™×§×ª BBC ×•××œ-×’'×–×™×¨×”. ×™×—×¡ ×’×‘×•×” ×©×œ ×›×•×ª×¨×•×ª ×”××›×™×œ×•×ª '××œ×—××”', '×ª×§×™×¤×”' ××• '×˜×™×œ×™×' ××¢×œ×” ××ª ×”×¡×™×›×•×Ÿ.",
                m_aviation_desc: "××¢×§×‘ ××—×¨ ×˜×™×¡×•×ª ××¡×—×¨×™×•×ª (OpenSky). ×™×¨×™×“×” ×‘×›××•×ª ×”×˜×™×¡×•×ª ××¢×™×“×” ×©×—×‘×¨×•×ª ×”×ª×¢×•×¤×” ×—×•×©×©×•×ª ××¡×™×›×•×Ÿ.",
                m_tankers_desc: "××¢×§×‘ ××—×¨ ××˜×•×¡×™ ×ª×“×œ×•×§ (KC-135). ×¢×œ×™×” ×‘×¤×¢×™×œ×•×ª ×××¤×©×¨×ª ×œ××˜×•×¡×™ ×§×¨×‘ ×œ×¤×¢×•×œ ×¨×—×•×§ ××”×‘×¡×™×¡.",
                m_pentagon_desc: "× ×™×ª×•×— ×“×¤×•×¡×™ ×¤×¢×™×œ×•×ª ×¡×‘×™×‘ ×”×¤× ×˜×’×•×Ÿ. ×¤×¢×™×œ×•×ª ×‘×©×¢×•×ª ×œ×™×œ×” ×××•×—×¨×•×ª ××¢×™×“×” ×¢×œ ×ª×›× ×•×Ÿ ×—×™×¨×•×.",
                m_market_desc: "×¡×™×›×•×™×™ ×”×™××•×¨×™× ×‘×›×¡×£ ×××™×ª×™ (Polymarket) ×¢×œ ×ª×§×™×¤×” ×‘×˜×•×•×— ×©×œ 7 ×™××™×.",
                m_weather_desc: "××–×’ ××•×•×™×¨ ×‘×˜×”×¨×Ÿ. ×©××™×™× × ×§×™×™× ××¢×œ×™× ××ª ×”×¡×™×›×•×Ÿ ×œ×¤×¢×™×œ×•×ª ××•×•×™×¨×™×ª ××“×•×™×§×ª."
            },
            ru: {
                donate: "ĞŸĞ¾Ğ¶ĞµÑ€Ñ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ",
                escalation_probability: "ĞĞ‘Ğ©Ğ˜Ğ™ Ğ Ğ˜Ğ¡Ğš",
                status: "Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ Ğ Ğ˜Ğ¡ĞšĞ:",
                last_update: "ĞĞ‘ĞĞĞ’Ğ›Ğ•ĞĞ:",
                risk_parameters: "Ğ¡Ğ˜Ğ“ĞĞĞ›Ğ«",
                share: "ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑ",
                disclaimer_short: "Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°. ĞĞµ ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¼ ÑĞ¾Ğ²ĞµÑ‚Ğ¾Ğ¼.",
                
                l_news: "ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚ĞµĞ¹",
                l_aviation: "Ğ“Ñ€Ğ°Ğ¶Ğ´Ğ°Ğ½ÑĞºĞ°Ñ Ğ°Ğ²Ğ¸Ğ°Ñ†Ğ¸Ñ",
                l_tankers: "Ğ’Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ½ĞºĞµÑ€Ñ‹",
                l_market: "Ğ Ñ‹Ğ½ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ¾Ğ²",
                l_pentagon: "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ ĞŸĞµĞ½Ñ‚Ğ°Ğ³Ğ¾Ğ½Ğ°",
                l_weather: "ĞŸĞ¾Ğ³Ğ¾Ğ´Ğ° (Ğ¢ĞµĞ³ĞµÑ€Ğ°Ğ½)",
                
                m_general_title: "ĞšĞ°Ğº Ğ¼Ñ‹ ÑÑ‡Ğ¸Ñ‚Ğ°ĞµĞ¼ Ñ€Ğ¸ÑĞº",
                m_general_desc: "Ğ’Ğ·Ğ²ĞµÑˆĞµĞ½Ğ½Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ° 6 ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ²: ĞĞ¾Ğ²Ğ¾ÑÑ‚Ğ¸, ĞĞ²Ğ¸Ğ°Ñ†Ğ¸Ñ, Ğ¢Ğ°Ğ½ĞºĞµÑ€Ñ‹, Ğ Ñ‹Ğ½ĞºĞ¸, ĞŸĞµĞ½Ñ‚Ğ°Ğ³Ğ¾Ğ½, ĞŸĞ¾Ğ³Ğ¾Ğ´Ğ°.",
                m_news_desc: "Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¾Ğ² Ğ½Ğ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ ÑĞ»Ğ¾Ğ² 'Ğ²Ğ¾Ğ¹Ğ½Ğ°', 'Ğ°Ñ‚Ğ°ĞºĞ°'.",
                m_aviation_desc: "ĞœĞµĞ½ÑŒÑˆĞµ Ğ³Ñ€Ğ°Ğ¶Ğ´Ğ°Ğ½ÑĞºĞ¸Ñ… Ñ€ĞµĞ¹ÑĞ¾Ğ² Ğ½Ğ°Ğ´ Ğ˜Ñ€Ğ°Ğ½Ğ¾Ğ¼ = Ğ²Ñ‹ÑˆĞµ Ñ€Ğ¸ÑĞº.",
                m_tankers_desc: "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ°Ğ²Ñ‰Ğ¸ĞºĞ¾Ğ² Ğ’Ğ’Ğ¡ Ğ¡Ğ¨Ğ Ğ² Ñ€ĞµĞ³Ğ¸Ğ¾Ğ½Ğµ.",
                m_pentagon_desc: "ĞĞµĞ¾Ğ±Ñ‹Ñ‡Ğ½Ğ°Ñ Ğ½Ğ¾Ñ‡Ğ½Ğ°Ñ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğ² ĞŸĞµĞ½Ñ‚Ğ°Ğ³Ğ¾Ğ½Ğµ.",
                m_market_desc: "Ğ¡Ñ‚Ğ°Ğ²ĞºĞ¸ Ğ½Ğ° Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´ĞµĞ½ÑŒĞ³Ğ¸ Ğ½Ğ° ÑƒĞ´Ğ°Ñ€ Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğµ 7 Ğ´Ğ½ĞµĞ¹.",
                m_weather_desc: "Ğ¯ÑĞ½Ğ¾Ğµ Ğ½ĞµĞ±Ğ¾ Ğ½Ğ°Ğ´ Ğ¢ĞµĞ³ĞµÑ€Ğ°Ğ½Ğ¾Ğ¼ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ¿Ñ€Ğ¸ÑÑ‚Ğ½Ğ¾ Ğ´Ğ»Ñ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¹."
            }
        };

        let currentLang = 'en';

        // --- CORE LOGIC ---
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('en-GB', { hour12: false });
        }
        setInterval(updateClock, 1000);

        // Simulation State
        let signalValues = {}; 
        
        function simulateData() {
            let totalWeightedScore = 0;
            let elevatedCount = 0; // Count signals > 30%

            // Initialize or slight randomize
            signalsConfig.forEach(sig => {
                // Determine value (Mock simulation with slight random flux)
                if (!signalValues[sig.id]) signalValues[sig.id] = sig.baseVal;
                
                const flux = (Math.random() * 6) - 3; 
                let val = signalValues[sig.id] + flux;
                val = Math.max(0, Math.min(100, val));
                signalValues[sig.id] = val;

                // Add to total
                totalWeightedScore += (val * sig.weight);

                // Check for multiplier condition
                if (val > 30) elevatedCount++;
            });

            // Escalation Multiplier Logic
            const multiplierBadge = document.getElementById('multiplierBadge');
            if (elevatedCount >= 3) {
                totalWeightedScore = totalWeightedScore * 1.15; // 15% Boost
                multiplierBadge.style.display = "inline-block";
            } else {
                multiplierBadge.style.display = "none";
            }

            // Cap at 100
            totalWeightedScore = Math.min(100, totalWeightedScore);

            updateUI(totalWeightedScore);
        }

        function updateUI(score) {
            // Main Score
            const scoreEl = document.getElementById('mainScore');
            scoreEl.innerText = score.toFixed(1) + '%';
            
            // Risk Level
            let color = '#00ff41'; // Low
            let status = 'LOW';
            if(score > 30) { color = '#ffb700'; status = 'ELEVATED'; } // Updated per prompt
            if(score > 60) { color = '#ff3333'; status = 'HIGH'; }     // Updated per prompt
            
            scoreEl.style.color = color;
            const statusEl = document.getElementById('statusText');
            statusEl.innerText = status;
            statusEl.style.color = color;

            // Timestamp
            document.getElementById('lastUpdate').innerText = new Date().toLocaleTimeString();

            // Render Parameters
            renderParams();
        }

        function renderParams() {
            const list = document.getElementById('parametersList');
            list.innerHTML = '';
            
            signalsConfig.forEach(sig => {
                const val = signalValues[sig.id];
                const label = content[currentLang][`l_${sig.id}`];
                
                let barColor = 'var(--primary)';
                if(val > 30) barColor = 'var(--warning)';
                if(val > 60) barColor = 'var(--danger)';

                const row = document.createElement('div');
                row.className = 'parameter-row';
                row.innerHTML = `
                    <div class="param-header">
                        <div class="param-label">
                            ${label}
                            <span class="info-icon" onclick="openModal('${sig.id}')">i</span>
                        </div>
                        <span>${val.toFixed(1)}%</span>
                    </div>
                    <div class="progress-bg">
                        <div class="progress-fill" style="width: ${val}%; background: ${barColor};"></div>
                    </div>
                `;
                list.appendChild(row);
            });
        }

        // --- MODAL LOGIC ---
        function openModal(type) {
            const modal = document.getElementById('infoModal');
            const titleEl = document.getElementById('mTitle');
            const contentEl = document.getElementById('mContent');
            
            // Determine Title & Content
            if (type === 'general') {
                titleEl.innerText = content[currentLang].m_general_title;
                contentEl.innerHTML = content[currentLang].m_general_desc;
            } else {
                titleEl.innerText = content[currentLang][`l_${type}`];
                contentEl.innerHTML = content[currentLang][`m_${type}_desc`];
            }

            modal.classList.add('open');
        }

        function closeModal(e, force = false) {
            if (force || e.target.id === 'infoModal') {
                document.getElementById('infoModal').classList.remove('open');
            }
        }

        // --- SHARE LOGIC ---
        async function shareSite() {
            const shareData = {
                title: 'WARADAR - US/Iran Risk Monitor',
                text: 'Current Escalation Risk: ' + document.getElementById('mainScore').innerText,
                url: window.location.href
            };

            if (navigator.share) {
                try {
                    await navigator.share(shareData);
                } catch (err) {
                    console.log('Error sharing:', err);
                }
            } else {
                // Fallback for desktop
                alert("URL copied to clipboard!");
                navigator.clipboard.writeText(window.location.href);
            }
        }

        // --- LANGUAGE SWITCHER ---
        function setLang(lang) {
            currentLang = lang;
            document.querySelectorAll('.flag').forEach(f => f.classList.remove('active'));
            event.currentTarget.classList.add('active');

            if(lang === 'he') document.body.classList.add('rtl');
            else document.body.classList.remove('rtl');

            // Update static text
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if(content[lang][key]) el.innerText = content[lang][key];
            });

            // Re-render dynamic components
            renderParams();
        }

        // Start
        updateClock();
        simulateData();
        setInterval(simulateData, 30000); 

    </script>
</body>
</html>
