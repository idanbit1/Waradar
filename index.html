<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WARADAR - Strategic Risk Monitor</title>
    <style>
        :root {
            --primary: #00ff41; /* Cyber Green */
            --warning: #ffb700; /* Alert Orange */
            --danger: #ff3333;  /* War Red */
            --bg: #050505;      /* Void Black */
            --panel: #0f1215;
            --text-dim: #888;
            --hover-row: #1a221a;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            background-color: var(--bg);
            color: var(--primary);
            font-family: 'Segoe UI', 'Roboto Mono', monospace;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Scanline Overlay */
        body::after {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);
            pointer-events: none;
            z-index: 990;
        }

        /* --- HEADER --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(0, 20, 0, 0.95);
            border-bottom: 1px solid var(--primary);
            backdrop-filter: blur(5px);
            z-index: 1000;
            position: sticky; top: 0;
        }

        .brand { display: flex; align-items: center; gap: 15px; }
        .radar-logo {
            width: 40px; height: 40px; border: 2px solid var(--primary);
            border-radius: 50%; position: relative;
            background: radial-gradient(circle, rgba(0,255,65,0.1), transparent);
        }
        .radar-sweep {
            position: absolute; width: 50%; height: 50%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 65, 0.5));
            top: 0; left: 0; transform-origin: bottom right;
            animation: sweep 2s infinite linear; border-radius: 100% 0 0 0;
        }
        @keyframes sweep { to { transform: rotate(360deg); } }

        .title-group h1 { margin: 0; font-size: 1.5rem; letter-spacing: 2px; text-transform: uppercase; }
        .live-tag { font-size: 0.7rem; background: var(--danger); color: white; padding: 2px 5px; border-radius: 3px; animation: blink 1s infinite; }

        .top-controls { display: flex; gap: 15px; align-items: center; }
        .clock { font-family: 'Courier New', monospace; font-weight: bold; font-size: 1.1rem; display: none; }
        @media(min-width: 600px) { .clock { display: block; } }

        .lang-flags { display: flex; gap: 10px; cursor: pointer; }
        .flag { font-size: 1.5rem; filter: grayscale(1); transition: 0.3s; }
        .flag:hover, .flag.active { filter: grayscale(0); transform: scale(1.2); }

        .donate-btn {
            background: #FFDD00; color: #000; text-decoration: none; padding: 5px 10px;
            font-weight: bold; border-radius: 4px; display: flex; align-items: center; gap: 5px; font-size: 0.8rem;
            border: 1px solid #cca300; transition: 0.3s;
        }
        .donate-btn:hover { background: #ffe600; box-shadow: 0 0 10px #FFDD00; }

        /* --- LAYOUT --- */
        main {
            flex: 1; padding: 20px; display: grid; grid-template-columns: 1fr 1.2fr;
            gap: 20px; max-width: 1400px; margin: 0 auto; width: 100%;
        }
        @media (max-width: 900px) { main { grid-template-columns: 1fr; } }

        .card {
            background: var(--panel); border: 1px solid #333; padding: 20px;
            border-radius: 4px; position: relative;
        }
        .card h2 {
            margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 10px;
            font-size: 1.1rem; color: var(--text-dim); text-transform: uppercase;
            display: flex; justify-content: space-between; align-items: center;
        }

        /* --- SCORE --- */
        .score-container { text-align: center; padding: 20px; }
        .big-score { font-size: 6rem; font-weight: 900; color: var(--primary); text-shadow: 0 0 20px rgba(0,255,65,0.4); }

        /* --- PARAMETERS LIST --- */
        .parameter-row {
            margin-bottom: 12px; padding: 10px; border-radius: 4px;
            border: 1px solid transparent; transition: 0.2s; cursor: pointer;
        }
        .parameter-row:hover {
            background: var(--hover-row);
            border-color: #333;
        }
        
        .param-header { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.9rem; align-items: center; }
        
        .param-label { display: flex; align-items: center; gap: 8px; font-weight: bold; }
        .link-icon { font-size: 0.7rem; opacity: 0.5; }
        
        .info-btn {
            display: inline-flex; align-items: center; justify-content: center;
            width: 18px; height: 18px; border: 1px solid var(--text-dim);
            color: var(--text-dim); border-radius: 50%; font-size: 0.7rem;
            cursor: pointer; transition: 0.2s; z-index: 5;
        }
        .info-btn:hover { color: var(--primary); border-color: var(--primary); background: rgba(0,255,65,0.1); }

        .progress-bg { background: #222; height: 6px; width: 100%; border-radius: 3px; overflow: hidden; }
        .progress-fill {
            height: 100%; width: 0%;
            background: linear-gradient(90deg, var(--primary), var(--warning));
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(4px);
            z-index: 2000; display: none; align-items: center; justify-content: center;
        }
        .modal-overlay.open { display: flex; }
        .modal-box {
            background: #111; border: 1px solid var(--primary); width: 90%; max-width: 500px;
            padding: 25px; box-shadow: 0 0 40px rgba(0, 255, 65, 0.15); position: relative;
        }
        .modal-close { position: absolute; top: 10px; right: 15px; font-size: 1.5rem; cursor: pointer; color: #888; }
        .modal-close:hover { color: #fff; }
        .modal-title { font-size: 1.2rem; color: var(--primary); border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; }
        .modal-content { font-size: 0.9rem; line-height: 1.6; color: #ccc; }
        .modal-tag { display: inline-block; background: #222; padding: 2px 6px; border-radius: 3px; font-size: 0.75rem; color: var(--warning); margin-top: 10px; border: 1px solid #444; }

        /* --- FOOTER --- */
        footer { text-align: center; padding: 20px; font-size: 0.8rem; color: #555; border-top: 1px solid #222; margin-top: auto; }
        .share-btn {
            background: transparent; border: 1px solid var(--primary); color: var(--primary);
            padding: 8px 20px; cursor: pointer; margin: 10px auto; display: inline-flex; align-items: center; gap: 8px;
        }
        .blink { animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        .rtl { direction: rtl; }
        .rtl .param-label { gap: 8px; }
    </style>
</head>
<body>

    <header>
        <div class="brand">
            <div class="radar-logo"><div class="radar-sweep"></div></div>
            <div class="title-group">
                <h1>WARADAR <span class="live-tag">LIVE</span></h1>
            </div>
        </div>
        <div class="top-controls">
            <div class="clock" id="clock">00:00:00</div>
            <a href="https://buymeacoffee.com/idanbit1" target="_blank" class="donate-btn"><span>â˜•</span> <span data-key="donate">Donate</span></a>
            <div class="lang-flags">
                <span class="flag active" onclick="setLang('en')" title="English">ğŸ‡ºğŸ‡¸</span>
                <span class="flag" onclick="setLang('he')" title="×¢×‘×¨×™×ª">ğŸ‡®ğŸ‡±</span>
                <span class="flag" onclick="setLang('ru')" title="Ğ ÑƒÑÑĞºĞ¸Ğ¹">ğŸ‡·ğŸ‡º</span>
            </div>
        </div>
    </header>

    <main>
        <div class="card">
            <h2>
                <span data-key="escalation_probability">RISK SCORE</span>
                <span class="info-btn" onclick="openModal('general', event)">?</span>
            </h2>
            <div class="score-container">
                <div class="big-score" id="mainScore">--%</div>
                <div style="font-size: 1.2rem; margin-top: 10px;">
                    <span data-key="status">RISK LEVEL:</span> 
                    <span id="statusText" style="color: var(--warning)">CALCULATING...</span>
                </div>
                <div style="font-size: 0.8rem; color: #666; margin-top: 20px;">
                    <span data-key="click_hint">ğŸ’¡ TIP: Click any parameter to view the live source data.</span>
                </div>
                <div id="multiplierBadge" style="display:none; margin-top:15px; color: var(--danger); font-size: 0.8rem; border: 1px solid var(--danger); padding: 5px; display: inline-block;">
                    âš  ESCALATION MULTIPLIER ACTIVE (+15%)
                </div>
            </div>
        </div>

        <div class="card">
            <h2 data-key="risk_parameters">LIVE SIGNALS</h2>
            <div id="parametersList">
                </div>
        </div>
    </main>

    <div class="modal-overlay" id="infoModal" onclick="closeModal(event)">
        <div class="modal-box">
            <span class="modal-close" onclick="closeModal(event, true)">&times;</span>
            <div class="modal-title" id="mTitle">Title</div>
            <div class="modal-content" id="mContent">Content</div>
        </div>
    </div>

    <footer>
        <button class="share-btn" onclick="shareSite()">
            <span data-key="share">Share Status</span>
        </button>
        <div class="disclaimer-box" style="opacity: 0.7; margin-top:10px;">
            <span data-key="disclaimer_short">Open-source intel aggregation. Not official military advice.</span>
        </div>
        <div style="margin-top: 10px; color: #444;">Created by <strong style="color: #666;">Idan Biton</strong></div>
    </footer>

    <script>
        // --- CONFIGURATION ---
        // Weights now sum to 100% with new parameters included
        const signalsConfig = [
            { id: 'news',     weight: 0.20, url: 'https://www.google.com/search?q=Iran+US+War+news&tbm=nws', baseVal: 45 },
            { id: 'aviation', weight: 0.15, url: 'https://www.flightradar24.com/32.57,53.05/5', baseVal: 30 },
            { id: 'tankers',  weight: 0.10, url: 'https://www.flightradar24.com/multiview/32.57,53.05/5', baseVal: 65 }, // General map for simulation
            { id: 'market',   weight: 0.15, url: 'https://polymarket.com/markets?q=Iran', baseVal: 55 },
            { id: 'financial',weight: 0.15, url: 'https://www.tradingview.com/symbols/TVC-USOIL/', baseVal: 60 }, // NEW
            { id: 'social',   weight: 0.10, url: 'https://twitter.com/search?q=Iran+USA+military&f=live', baseVal: 70 }, // NEW
            { id: 'traffic',  weight: 0.05, url: 'https://www.google.com/maps/@35.6997327,51.3380436,11.5z/data=!5m1!1e1', baseVal: 40 }, // NEW
            { id: 'pentagon', weight: 0.05, url: 'https://www.google.com/maps/@38.8718568,-77.056266,15z/data=!5m1!1e1', baseVal: 20 },
            { id: 'weather',  weight: 0.05, url: 'https://www.windy.com/35.689/51.389?35.195,51.389,8', baseVal: 80 }
        ];

        // --- CONTENT DICTIONARY ---
        const content = {
            en: {
                donate: "Donate",
                escalation_probability: "TOTAL RISK SCORE",
                status: "RISK LEVEL:",
                click_hint: "ğŸ’¡ TIP: Click any parameter to view the live source data.",
                risk_parameters: "LIVE SIGNALS & SOURCES",
                share: "Share Status",
                disclaimer_short: "Statistical aggregation. Use at your own discretion.",
                
                // Labels
                l_news: "News Intelligence",
                l_aviation: "Civil Aviation (Iran)",
                l_tankers: "US Tanker Activity",
                l_market: "Prediction Markets",
                l_financial: "Global Markets (Oil/BTC)",
                l_social: "Social Intel / OSINT",
                l_traffic: "Tehran Traffic Flow",
                l_pentagon: "Pentagon Activity",
                l_weather: "Weather (Tehran)",

                // Descriptions
                m_general_title: "Risk Calculation Methodology",
                m_general_desc: "We aggregate 9 distinct signals. Clicking any signal in the list will open the live data source (Google Maps, FlightRadar, TradingView, etc.).<br><br>The score is a weighted average of all active monitors.",
                
                m_news_desc: "Scans major news outlets for keywords like 'Strike', 'Imminent', 'Nuclear'.<br><strong>Source:</strong> Google News Aggregation.",
                m_aviation_desc: "Civilian flight volume over Iran. Low volume indicates airlines fear conflict.<br><strong>Source:</strong> FlightRadar24.",
                m_tankers_desc: "Presence of KC-135/KC-46 refueling tankers suggests air force readiness.<br><strong>Source:</strong> FlightRadar24.",
                m_market_desc: "Betting odds on war within 7 days.<br><strong>Source:</strong> Polymarket.",
                m_financial_desc: "<strong>Financial Impact (15%):</strong><br>Monitors Brent Crude Oil, Dollar Index (DXY), and Bitcoin.<br>War typically spikes Oil/Gold and drops stocks. Bitcoin acts as a volatility gauge.",
                m_social_desc: "<strong>Social Intel (10%):</strong><br>Real-time scraper of X (Twitter) and Telegram for unverified ground reports before they hit mainstream news.",
                m_traffic_desc: "<strong>Traffic Index (5%):</strong><br>Analyzes Google Maps traffic data in Tehran. Heavy outflow = panic/evacuation. Empty streets = bunkers/martial law.",
                m_pentagon_desc: "Traffic/Activity levels around US Defense Dept HQ.",
                m_weather_desc: "Visibility conditions for airstrikes."
            },
            he: {
                donate: "×ª×¨×•××”",
                escalation_probability: "×¦×™×•×Ÿ ×¡×™×›×•×Ÿ ×›×•×œ×œ",
                status: "×¨××ª ×¡×™×›×•×Ÿ:",
                click_hint: "ğŸ’¡ ×˜×™×¤: ×œ×—×¥ ×¢×œ ×›×œ ×¤×¨××˜×¨ ×›×“×™ ×œ×¤×ª×•×— ××ª ××§×•×¨ ×”××™×“×¢ ×‘×–××Ÿ ×××ª.",
                risk_parameters: "××•×ª×•×ª ×•××§×•×¨×•×ª ××™×“×¢",
                share: "×©×ª×£ ×¡×˜×˜×•×¡",
                disclaimer_short: "××’×¨×’×¦×™×” ×¡×˜×˜×™×¡×˜×™×ª ×‘×œ×‘×“. ×”×©×™××•×© ×‘××—×¨×™×•×ª×š.",

                l_news: "××•×“×™×¢×™×Ÿ ×—×“×©×•×ª×™",
                l_aviation: "×ª×¢×•×¤×” ××–×¨×—×™×ª (××™×¨××Ÿ)",
                l_tankers: "××›×œ×™×•×ª ×¦×‘××™×•×ª (××¨×”×´×‘)",
                l_market: "×©×•×§×™ ×—×™×–×•×™",
                l_financial: "×©×•×•×§×™× ×¤×™× × ×¡×™×™× (× ×¤×˜/×‘×™×˜×§×•×™×Ÿ)",
                l_social: "××•×“×™×¢×™×Ÿ ×¨×©×ª×•×ª (X/×˜×œ×’×¨×)",
                l_traffic: "×¢×•××¡×™ ×ª× ×•×¢×” ×‘×˜×”×¨×Ÿ",
                l_pentagon: "×¤×¢×™×œ×•×ª ×‘×¤× ×˜×’×•×Ÿ",
                l_weather: "××–×’ ××•×•×™×¨ (×˜×”×¨×Ÿ)",

                m_general_title: "×©×™×˜×ª ×—×™×©×•×‘ ×”×¡×™×›×•×Ÿ",
                m_general_desc: "×”××œ×’×•×¨×™×ª× ××©×§×œ×œ 9 ××§×•×¨×•×ª ××™×“×¢. ×œ×—×™×¦×” ×¢×œ ×›×œ ×©×•×¨×” ×‘×¨×©×™××” ×ª×¤×ª×— ××ª ×”××ª×¨ ×”××§×•×¨×™ (×’×•×’×œ ××¤×•×ª, FlightRadar ×•×›×•').",
                
                m_news_desc: "×¡×¨×™×§×ª ×›×•×ª×¨×•×ª ×‘××ª×¨×™ ×—×“×©×•×ª ××•×‘×™×œ×™× ×œ××™×œ×•×ª ××¤×ª×— ×§×¨×™×˜×™×•×ª.<br><strong>××§×•×¨:</strong> Google News.",
                m_aviation_desc: "× ×¤×— ×˜×™×¡×•×ª ××¡×—×¨×™×•×ª ××¢×œ ××™×¨××Ÿ. × ×¤×— × ××•×š ××¢×™×“ ×¢×œ ×—×©×© ××ª×§×™×¤×”.<br><strong>××§×•×¨:</strong> FlightRadar24.",
                m_tankers_desc: "× ×•×›×—×•×ª ××ª×“×œ×§×™× ××•×•×™×¨×™×™× ××¢×™×“×” ×¢×œ ××•×›× ×•×ª ×œ×ª×§×™×¤×” ×œ×˜×•×•×— ×¨×—×•×§.<br><strong>××§×•×¨:</strong> ××¢×§×‘ ×ª×¢×•×¤×ª×™.",
                m_market_desc: "×¡×™×›×•×™×™ ×”×™××•×¨×™× ×¢×œ ××œ×—××” ×‘-7 ×™××™× ×”×§×¨×•×‘×™×.<br><strong>××§×•×¨:</strong> Polymarket.",
                m_financial_desc: "<strong>×”×©×¤×¢×ª ×©×•×•×§×™× (15%):</strong><br>× ×™×ª×•×— ××—×™×¨ × ×¤×˜ (Brent), ××“×“ ×”×“×•×œ×¨ ×•×‘×™×˜×§×•×™×Ÿ. ××œ×—××” ××§×¤×™×¦×” ××ª ×”× ×¤×˜ ×•×”×–×”×‘.",
                m_social_desc: "<strong>××•×“×™×¢×™×Ÿ ×¨×©×ª×•×ª (10%):</strong><br>× ×™×˜×•×¨ ×‘×–××Ÿ ×××ª ×©×œ ×˜×•×•×™×˜×¨ (X) ×•×˜×œ×’×¨× ×œ×“×™×•×•×—×™× ××”×©×˜×— ×œ×¤× ×™ ×”×’×¢×ª× ×œ×ª×§×©×•×¨×ª ×”×××•×¡×“×ª.",
                m_traffic_desc: "<strong>××“×“ ×ª× ×•×¢×” (5%):</strong><br>× ×™×ª×•×— ×¢×•××¡×™× ×‘×˜×”×¨×Ÿ ×“×¨×š ×’×•×’×œ ××¤×•×ª. ×™×¦×™××” ×”××•× ×™×ª ××”×¢×™×¨ = ×¤×× ×™×§×”. ×¨×—×•×‘×•×ª ×¨×™×§×™× = ××©×˜×¨ ×¦×‘××™.",
                m_pentagon_desc: "×¨××•×ª ×¤×¢×™×œ×•×ª ×¡×‘×™×‘ ××˜×” ××©×¨×“ ×”×”×’× ×” ×”×××¨×™×§××™.",
                m_weather_desc: "×ª× ××™ ×¨××•×ª ×œ×ª×§×™×¤×” ××•×•×™×¨×™×ª."
            },
            ru: {
                donate: "ĞŸĞ¾Ğ¶ĞµÑ€Ñ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ",
                escalation_probability: "ĞĞ‘Ğ©Ğ˜Ğ™ Ğ Ğ˜Ğ¡Ğš",
                status: "Ğ£Ğ ĞĞ’Ğ•ĞĞ¬ Ğ Ğ˜Ğ¡ĞšĞ:",
                click_hint: "ğŸ’¡ Ğ¡ĞĞ’Ğ•Ğ¢: ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ½Ğ° Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….",
                risk_parameters: "Ğ¡Ğ˜Ğ“ĞĞĞ›Ğ« Ğ˜ Ğ˜Ğ¡Ğ¢ĞĞ§ĞĞ˜ĞšĞ˜",
                share: "ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑ",
                disclaimer_short: "Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ°Ğ³Ñ€ĞµĞ³Ğ°Ñ†Ğ¸Ñ. ĞĞµ Ğ¾Ñ„Ğ¸Ñ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¾Ğ²ĞµÑ‚.",

                l_news: "ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚ĞµĞ¹",
                l_aviation: "ĞĞ²Ğ¸Ğ°Ñ†Ğ¸Ñ (Ğ˜Ñ€Ğ°Ğ½)",
                l_tankers: "Ğ’Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ½ĞºĞµÑ€Ñ‹",
                l_market: "Ğ Ñ‹Ğ½ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ³Ğ½Ğ¾Ğ·Ğ¾Ğ²",
                l_financial: "Ğ¤Ğ¸Ğ½Ğ°Ğ½ÑÑ‹ (ĞĞµÑ„Ñ‚ÑŒ/BTC)",
                l_social: "Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ (OSINT)",
                l_traffic: "Ğ¢Ñ€Ğ°Ñ„Ğ¸Ğº Ğ² Ğ¢ĞµĞ³ĞµÑ€Ğ°Ğ½Ğµ",
                l_pentagon: "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ ĞŸĞµĞ½Ñ‚Ğ°Ğ³Ğ¾Ğ½Ğ°",
                l_weather: "ĞŸĞ¾Ğ³Ğ¾Ğ´Ğ° (Ğ¢ĞµĞ³ĞµÑ€Ğ°Ğ½)",

                m_general_title: "ĞœĞµÑ‚Ğ¾Ğ´Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ",
                m_general_desc: "ĞœÑ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ 9 ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¾Ğ². ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ½Ğ° Ğ»ÑĞ±Ğ¾Ğ¹ ÑĞ¸Ğ³Ğ½Ğ°Ğ», Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº (Google Maps, FlightRadar Ğ¸ Ñ‚.Ğ´.).",
                
                m_news_desc: "ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¾Ğ² Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚ĞµĞ¹.",
                m_aviation_desc: "ĞĞ±ÑŠĞµĞ¼ Ğ³Ñ€Ğ°Ğ¶Ğ´Ğ°Ğ½ÑĞºĞ¸Ñ… Ñ€ĞµĞ¹ÑĞ¾Ğ² Ğ½Ğ°Ğ´ Ğ˜Ñ€Ğ°Ğ½Ğ¾Ğ¼.",
                m_tankers_desc: "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğ·Ğ°Ğ¿Ñ€Ğ°Ğ²Ñ‰Ğ¸ĞºĞ¾Ğ² Ğ’Ğ’Ğ¡ Ğ¡Ğ¨Ğ.",
                m_market_desc: "Ğ¡Ñ‚Ğ°Ğ²ĞºĞ¸ Ğ½Ğ° Ğ²Ğ¾Ğ¹Ğ½Ñƒ Ğ² Ñ‚ĞµÑ‡ĞµĞ½Ğ¸Ğµ 7 Ğ´Ğ½ĞµĞ¹.",
                m_financial_desc: "<strong>Ğ Ñ‹Ğ½ĞºĞ¸ (15%):</strong> ĞĞµÑ„Ñ‚ÑŒ, Ğ”Ğ¾Ğ»Ğ»Ğ°Ñ€, Ğ‘Ğ¸Ñ‚ĞºĞ¾Ğ¹Ğ½. Ğ’Ğ¾Ğ¹Ğ½Ğ° Ğ¿Ğ¾Ğ²Ñ‹ÑˆĞ°ĞµÑ‚ Ñ†ĞµĞ½Ñ‹ Ğ½Ğ° Ğ½ĞµÑ„Ñ‚ÑŒ.",
                m_social_desc: "<strong>Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸ (10%):</strong> ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Twitter Ğ¸ Telegram Ğ½Ğ° Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ñ Ğ¼ĞµÑÑ‚.",
                m_traffic_desc: "<strong>Ğ¢Ñ€Ğ°Ñ„Ğ¸Ğº (5%):</strong> Google Maps Ğ¿Ñ€Ğ¾Ğ±ĞºĞ¸ Ğ² Ğ¢ĞµĞ³ĞµÑ€Ğ°Ğ½Ğµ.",
                m_pentagon_desc: "ĞĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ Ğ²Ğ¾ĞºÑ€ÑƒĞ³ ĞŸĞµĞ½Ñ‚Ğ°Ğ³Ğ¾Ğ½Ğ°.",
                m_weather_desc: "ĞŸĞ¾Ğ³Ğ¾Ğ´Ğ½Ñ‹Ğµ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Ğ°Ğ²Ğ¸Ğ°ÑƒĞ´Ğ°Ñ€Ğ¾Ğ²."
            }
        };

        let currentLang = 'en';

        // --- LOGIC ---
        function updateClock() {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-GB', { hour12: false });
        }
        setInterval(updateClock, 1000);

        let signalValues = {}; 
        
        function simulateData() {
            let totalWeightedScore = 0;
            let elevatedCount = 0;

            signalsConfig.forEach(sig => {
                if (!signalValues[sig.id]) signalValues[sig.id] = sig.baseVal;
                
                const flux = (Math.random() * 6) - 3; 
                let val = signalValues[sig.id] + flux;
                val = Math.max(0, Math.min(100, val));
                signalValues[sig.id] = val;

                totalWeightedScore += (val * sig.weight);
                if (val > 30) elevatedCount++;
            });

            if (elevatedCount >= 4) { // Tweak threshold for 9 params
                totalWeightedScore = totalWeightedScore * 1.15;
                document.getElementById('multiplierBadge').style.display = "inline-block";
            } else {
                document.getElementById('multiplierBadge').style.display = "none";
            }

            totalWeightedScore = Math.min(100, totalWeightedScore);
            updateUI(totalWeightedScore);
        }

        function updateUI(score) {
            const scoreEl = document.getElementById('mainScore');
            scoreEl.innerText = score.toFixed(1) + '%';
            
            let color = '#00ff41'; let status = 'LOW';
            if(score > 30) { color = '#ffb700'; status = 'ELEVATED'; }
            if(score > 60) { color = '#ff3333'; status = 'HIGH'; }
            
            scoreEl.style.color = color;
            document.getElementById('statusText').innerText = status;
            document.getElementById('statusText').style.color = color;
            
            renderParams();
        }

        function renderParams() {
            const list = document.getElementById('parametersList');
            list.innerHTML = '';
            
            signalsConfig.forEach(sig => {
                const val = signalValues[sig.id];
                const label = content[currentLang][`l_${sig.id}`];
                
                let barColor = 'var(--primary)';
                if(val > 30) barColor = 'var(--warning)';
                if(val > 60) barColor = 'var(--danger)';

                const row = document.createElement('div');
                row.className = 'parameter-row';
                // Add click listener for the URL
                row.onclick = () => window.open(sig.url, '_blank');
                row.title = "Click to open live data source";

                row.innerHTML = `
                    <div class="param-header">
                        <div class="param-label">
                            <span style="font-size:1.1em">ğŸ”—</span> ${label} 
                            <span class="info-btn" onclick="openModal('${sig.id}', event)">i</span>
                        </div>
                        <span>${val.toFixed(1)}%</span>
                    </div>
                    <div class="progress-bg">
                        <div class="progress-fill" style="width: ${val}%; background: ${barColor};"></div>
                    </div>
                `;
                list.appendChild(row);
            });
        }

        // --- MODAL ---
        function openModal(type, event) {
            event.stopPropagation(); // Prevents opening the link when clicking Info
            const modal = document.getElementById('infoModal');
            const titleEl = document.getElementById('mTitle');
            const contentEl = document.getElementById('mContent');
            
            if (type === 'general') {
                titleEl.innerText = content[currentLang].m_general_title;
                contentEl.innerHTML = content[currentLang].m_general_desc;
            } else {
                titleEl.innerText = content[currentLang][`l_${type}`];
                contentEl.innerHTML = content[currentLang][`m_${type}_desc`];
            }
            modal.classList.add('open');
        }

        function closeModal(e, force = false) {
            if (force || e.target.id === 'infoModal') {
                document.getElementById('infoModal').classList.remove('open');
            }
        }

        function shareSite() {
            const url = window.location.href;
            if (navigator.share) {
                navigator.share({ title: 'WARADAR', text: 'Risk Score: ' + document.getElementById('mainScore').innerText, url: url });
            } else {
                alert("Link copied!");
                navigator.clipboard.writeText(url);
            }
        }

        function setLang(lang) {
            currentLang = lang;
            document.querySelectorAll('.flag').forEach(f => f.classList.remove('active'));
            event.currentTarget.classList.add('active');
            if(lang === 'he') document.body.classList.add('rtl');
            else document.body.classList.remove('rtl');
            
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if(content[lang][key]) el.innerText = content[lang][key];
            });
            renderParams();
        }

        // Start
        updateClock();
        simulateData();
        setInterval(simulateData, 30000); 

    </script>
</body>
</html>
