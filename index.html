<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WARADAR | Global Intelligence</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg: #0b0e14;
            --card-bg: #151a23;
            --text: #e0e6ed;
            --accent: #ff3333;
            --safe: #00ce7c;
            --warn: #ffb700;
            --grid-line: #2d3748;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; padding: 0; overflow-x: hidden; padding-bottom: 50px;
            transition: all 0.3s ease;
        }

        /* --- HEADER --- */
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; background: rgba(11, 14, 20, 0.98);
            border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 100;
        }
        .header-left { display: flex; align-items: center; gap: 15px; }
        .logo-text {
            font-size: 1.8rem; font-weight: 800; letter-spacing: 2px;
            background: linear-gradient(90deg, #fff, #aaa); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            display: flex; align-items: center; gap: 10px;
        }
        .live-badge {
            background: #ff0000; color: white; padding: 4px 10px; border-radius: 4px;
            font-size: 0.9rem; font-weight: bold; display: flex; align-items: center; gap: 5px;
            box-shadow: 0 0 15px #ff0000; animation: blink 1s infinite alternate;
        }
        @keyframes blink { from { opacity: 1; } to { opacity: 0.6; } }

        .header-controls { display: flex; align-items: center; gap: 15px; }
        .lang-flags img { width: 28px; height: 28px; border-radius: 50%; cursor: pointer; opacity: 0.5; margin-left: 5px; transition: 0.3s; border: 2px solid transparent; }
        .lang-flags img.active, .lang-flags img:hover { opacity: 1; border-color: #fff; transform: scale(1.1); }

        .donate-btn {
            background: #FFDD00; color: #000; padding: 8px 15px; border-radius: 20px;
            text-decoration: none; font-weight: bold; display: flex; align-items: center; gap: 8px; font-size: 0.9rem;
        }

        /* --- RSS TICKER --- */
        .rss-ticker {
            background: #000; color: #fff; padding: 8px 0; overflow: hidden; white-space: nowrap;
            border-bottom: 1px solid #333; font-size: 0.9rem; font-family: monospace; position: relative;
        }
        .rss-content { display: inline-block; padding-left: 100%; animation: scroll-left 60s linear infinite; }
        .rss-item { display: inline-block; padding: 0 40px; color: #ccc; }
        .rss-item b { color: var(--accent); margin-right: 5px; }
        @keyframes scroll-left { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* --- TIMERS --- */
        .time-bar {
            background: #1a202c; padding: 10px; text-align: center; font-size: 0.9rem; color: #a0aec0;
            display: flex; justify-content: center; gap: 20px; border-bottom: 1px solid #333;
        }
        .time-value { color: var(--warn); font-weight: bold; font-family: monospace; }

        .container { max-width: 1200px; margin: 20px auto; padding: 0 15px; }

        /* --- GAUGE --- */
        .gauge-section { display: flex; flex-direction: column; align-items: center; margin: 30px 0; position: relative; }
        .gauge-outer {
            width: 300px; height: 150px;
            background: conic-gradient(from 180deg at 50% 100%, #00ce7c 0deg 60deg, #ffb700 60deg 120deg, #ff3333 120deg 180deg);
            border-radius: 150px 150px 0 0; position: relative; box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
        }
        .gauge-inner {
            width: 240px; height: 120px; background: var(--bg);
            border-radius: 120px 120px 0 0; position: absolute; bottom: 0; left: 30px;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-end; padding-bottom: 10px;
        }
        .risk-label { font-size: 2.5rem; font-weight: bold; }
        .risk-sub { font-size: 1rem; color: #888; text-transform: uppercase; }
        .needle {
            width: 4px; height: 130px; background: #fff; position: absolute; bottom: 0; left: 50%;
            transform-origin: bottom center; transform: rotate(-90deg); transition: transform 2s cubic-bezier(0.1, 1.7, 0.5, 1); z-index: 10;
        }
        .needle-pivot { width: 16px; height: 16px; background: #fff; border-radius: 50%; position: absolute; bottom: -8px; left: calc(50% - 8px); z-index: 11; }

        /* --- DATA GRID --- */
        .data-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 40px; }
        .data-card {
            background: var(--card-bg); border: 1px solid var(--grid-line); border-radius: 8px; padding: 15px;
            display: flex; flex-direction: column; transition: 0.3s;
        }
        .data-card:hover { transform: translateY(-5px); border-color: #666; }
        .card-top { display: flex; justify-content: space-between; }
        .card-percent { font-size: 1.5rem; font-weight: bold; }
        .card-title { font-size: 1rem; font-weight: 600; margin: 5px 0; }
        .card-source { font-size: 0.8rem; color: #888; }
        .chart-container { height: 50px; width: 100%; margin-top: auto; }

        /* --- POLLS & COMMENTS --- */
        .section-title { border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 20px; font-weight: bold; font-size: 1.2rem; }
        .poll-item { background: var(--card-bg); padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #333; }
        .poll-q { font-weight: bold; margin-bottom: 10px; display: block; }
        .poll-opts { display: flex; gap: 10px; }
        .poll-btn { flex: 1; padding: 10px; background: #2d3748; border: none; color: white; cursor: pointer; border-radius: 4px; }
        .poll-btn:hover { background: #4a5568; }
        .poll-res { display: none; margin-top: 10px; }
        .res-bar { height: 8px; background: #333; border-radius: 4px; overflow: hidden; display: flex; }
        
        .comments-wrapper { background: var(--card-bg); padding: 20px; border-radius: 10px; border: 1px solid #333; margin-top: 40px; }
        .comm-header { display: flex; justify-content: space-between; color: #888; font-size: 0.9rem; margin-bottom: 15px; }
        .comm-scroll { height: 350px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .comment { background: rgba(0,0,0,0.3); padding: 10px; border-radius: 5px; border-left: 2px solid #555; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .c-meta { display: flex; justify-content: space-between; font-size: 0.75rem; color: #aaa; margin-bottom: 4px; }
        
        /* --- DISCLAIMER FOOTER --- */
        footer { margin-top: 50px; padding: 30px; background: #080a0f; border-top: 1px solid #222; text-align: center; }
        .disclaimer-box {
            border: 1px solid #ff3333; background: rgba(255, 51, 51, 0.05);
            padding: 20px; border-radius: 8px; font-size: 0.85rem; color: #ccc; line-height: 1.6; text-align: left;
        }
        .disclaimer-box strong { color: #ff3333; text-transform: uppercase; }

        /* RTL SUPPORT */
        body[dir="rtl"] { direction: rtl; }
        body[dir="rtl"] .card-top, body[dir="rtl"] .c-meta, body[dir="rtl"] .comm-header { flex-direction: row-reverse; }
        body[dir="rtl"] .comment { border-left: none; border-right: 2px solid #555; }
        body[dir="rtl"] .needle { transform-origin: bottom center; } /* Needle fix for RTL */
        body[dir="rtl"] .disclaimer-box { text-align: right; }

        /* MOBILE */
        @media (max-width: 600px) {
            header { flex-direction: column; gap: 10px; }
            .header-controls { width: 100%; justify-content: space-between; }
            .gauge-section { transform: scale(0.85); margin: 0; }
            .data-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body dir="ltr">

<header>
    <div class="header-left">
        <div class="live-badge"><i class="fas fa-circle"></i> LIVE</div>
        <div class="logo-text"><i class="fas fa-satellite"></i> WARADAR</div>
    </div>
    <div class="header-controls">
        <div class="lang-flags">
            <img src="https://flagcdn.com/w40/us.png" onclick="setLang('en')" class="active" title="English">
            <img src="https://flagcdn.com/w40/il.png" onclick="setLang('he')" title="עברית">
            <img src="https://flagcdn.com/w40/fr.png" onclick="setLang('fr')" title="Français">
            <img src="https://flagcdn.com/w40/ru.png" onclick="setLang('ru')" title="Русский">
        </div>
        <a href="https://buymeacoffee.com/idanbit1" target="_blank" class="donate-btn" data-i18n="donate">Donate</a>
    </div>
</header>

<div class="rss-ticker">
    <div class="rss-content" id="rss-feed-content">
        <span class="rss-item">Initializing satellite uplink...</span>
    </div>
</div>

<div class="time-bar">
    <div><span data-i18n="last_update">Last Update:</span> <span class="time-value" id="lastUpdate">--:--</span></div>
    <div><span data-i18n="next_scan">Next Scan:</span> <span class="time-value" id="nextScan">30:00</span></div>
</div>

<div class="container">

    <div class="gauge-section">
        <div class="gauge-outer">
            <div class="needle" id="mainNeedle"></div>
            <div class="needle-pivot"></div>
            <div class="gauge-inner">
                <div class="risk-label" id="riskPercent">0%</div>
                <div class="risk-sub" data-i18n="risk_sub">Weighted Probability</div>
            </div>
        </div>
        <div style="margin-top: 15px; font-weight: bold; color: #888;" id="riskText">CALCULATING INTEL...</div>
    </div>

    <div class="data-grid">
        <div class="data-card">
            <div class="card-top"><i class="fas fa-pizza-slice fa-lg"></i><span class="card-percent" style="color:var(--warn)">55%</span></div>
            <div class="card-title" data-i18n="card_pizza">Pentagon Pizza</div>
            <div class="card-source" data-i18n="src_pizza">Dominos VA (High)</div>
            <div class="chart-container"><canvas id="c1"></canvas></div>
        </div>
        <div class="data-card">
            <div class="card-top"><i class="fas fa-satellite-dish fa-lg"></i><span class="card-percent" style="color:red">92%</span></div>
            <div class="card-title" data-i18n="card_gps">GPS Jamming</div>
            <div class="card-source" data-i18n="src_gps">TLV/Haifa (Red)</div>
            <div class="chart-container"><canvas id="c2"></canvas></div>
        </div>
        <div class="data-card">
            <div class="card-top"><i class="fas fa-newspaper fa-lg"></i><span class="card-percent" style="color:var(--warn)">65%</span></div>
            <div class="card-title" data-i18n="card_news">News Sentiment</div>
            <div class="card-source" data-i18n="src_news">GDELT (Negative)</div>
            <div class="chart-container"><canvas id="c3"></canvas></div>
        </div>
        <div class="data-card">
            <div class="card-top"><i class="fas fa-search fa-lg"></i><span class="card-percent" style="color:var(--safe)">28%</span></div>
            <div class="card-title" data-i18n="card_wiki">Public Interest</div>
            <div class="card-source" data-i18n="src_wiki">Wiki Views (Normal)</div>
            <div class="chart-container"><canvas id="c4"></canvas></div>
        </div>
         <div class="data-card">
            <div class="card-top"><i class="fas fa-plane-slash fa-lg"></i><span class="card-percent" style="color:var(--safe)">30%</span></div>
            <div class="card-title" data-i18n="card_flight">Flight Cancels</div>
            <div class="card-source" data-i18n="src_flight">AviationStack (Low)</div>
            <div class="chart-container"><canvas id="c5"></canvas></div>
        </div>
        <div class="data-card">
            <div class="card-top"><i class="fas fa-chart-line fa-lg"></i><span class="card-percent" style="color:var(--safe)">15%</span></div>
            <div class="card-title" data-i18n="card_market">Market Odds</div>
            <div class="card-source" data-i18n="src_market">Polymarket (Stable)</div>
            <div class="chart-container"><canvas id="c6"></canvas></div>
        </div>
         <div class="data-card">
            <div class="card-top"><i class="fas fa-cloud-moon fa-lg"></i><span class="card-percent" style="color:#fff">85%</span></div>
            <div class="card-title" data-i18n="card_ops">Op. Conditions</div>
            <div class="card-source" data-i18n="src_ops">Weather (Clear)</div>
            <div class="chart-container"><canvas id="c7"></canvas></div>
        </div>
        <div class="data-card">
            <div class="card-top"><i class="fas fa-jet-fighter fa-lg"></i><span class="card-percent" style="color:var(--warn)">40%</span></div>
            <div class="card-title" data-i18n="card_tanker">Mil. Tankers</div>
            <div class="card-source" data-i18n="src_tanker">ADS-B (Medium)</div>
            <div class="chart-container"><canvas id="c8"></canvas></div>
        </div>
    </div>

    <div class="section-title" data-i18n="sect_polls">Community Polls</div>
    <div id="polls-container"></div>

    <div class="comments-wrapper">
        <div class="comm-header">
            <span><i class="fas fa-comments"></i> <span data-i18n="feed_title">Live Encrypted Feed</span></span>
            <span><i class="fas fa-user-secret"></i> <span id="userCount">24,402</span></span>
        </div>
        <div class="comm-scroll" id="feed"></div>
        <div style="margin-top:10px; display:flex; gap:10px;">
            <input type="text" id="newComm" placeholder="Enter anonymous report..." style="flex:1; background:#000; border:1px solid #444; color:#fff; padding:10px; border-radius:4px;">
            <button onclick="postComment()" style="background:var(--safe); border:none; padding:0 20px; font-weight:bold; border-radius:4px;">SEND</button>
        </div>
    </div>

</div>

<footer>
    <div class="disclaimer-box" data-i18n="disclaimer">
        <strong>⚠️ IMPORTANT DISCLAIMER & LIMITATIONS OF LIABILITY</strong><br><br>
        This website is an independent, experimental project. It DOES NOT display classified intelligence.
        The data is based on OSINT sources. Use at your own risk.
    </div>
</footer>

<script>
    // --- 1. LANGUAGE SYSTEM (Fixed) ---
    const i18n = {
        en: {
            donate: "Donate", last_update: "Last Update:", next_scan: "Next Scan:",
            risk_sub: "Weighted Probability",
            card_pizza: "Pentagon Pizza", src_pizza: "Dominos VA (High)",
            card_gps: "GPS Jamming", src_gps: "TLV/Haifa (Red)",
            card_news: "News Sentiment", src_news: "GDELT (Negative)",
            card_wiki: "Public Interest", src_wiki: "Wiki Views (Normal)",
            card_flight: "Flight Cancels", src_flight: "AviationStack (Low)",
            card_market: "Market Odds", src_market: "Polymarket (Stable)",
            card_ops: "Op. Conditions", src_ops: "Weather (Clear)",
            card_tanker: "Mil. Tankers", src_tanker: "ADS-B (Medium)",
            sect_polls: "Community Polls", feed_title: "Live Encrypted Feed",
            disclaimer: `<strong>⚠️ IMPORTANT DISCLAIMER & LIMITATIONS OF LIABILITY</strong><br><br>This website ("WARADAR") is an independent, experimental open-source project created for informational and visualization purposes only. The "Risk Probability" and "Gauges" presented herein are calculated using automated algorithms based on publicly available data sources (OSINT).<br><strong>This site DOES NOT display classified military intelligence.</strong>`
        },
        he: {
            donate: "תרומה", last_update: "עדכון אחרון:", next_scan: "סריקה הבאה:",
            risk_sub: "הסתברות משוקללת",
            card_pizza: "מדד הפיצה", src_pizza: "דומינוס וירג'יניה (גבוה)",
            card_gps: "שיבושי GPS", src_gps: "ת\"א/חיפה (אדום)",
            card_news: "סנטימנט חדשות", src_news: "GDELT (שלילי)",
            card_wiki: "התעניינות ציבור", src_wiki: "ויקיפדיה (רגיל)",
            card_flight: "ביטולי טיסות", src_flight: "נתב\"ג (נמוך)",
            card_market: "סיכויי שוק", src_market: "פולימרקט (יציב)",
            card_ops: "תנאים מבצעיים", src_ops: "מזג אוויר (בהיר)",
            card_tanker: "מיכליות תדלוק", src_tanker: "ADS-B (בינוני)",
            sect_polls: "סקר גולשים", feed_title: "עדכונים מוצפנים",
            disclaimer: `<strong>⚠️ הצהרת אחריות משפטית ומגבלות</strong><br><br>אתר זה ("WARADAR") הינו פרויקט עצמאי, ניסיוני ופתוח שנוצר למטרות מידע והמחשה בלבד. המדדים וההסתברויות המוצגים באתר מחושבים באמצעות אלגוריתמים אוטומטיים המתבססים על מקורות מידע גלויים (OSINT).<br><strong>האתר אינו מציג מודיעין צבאי מסווג, תחזיות ממשלתיות מאומתות או סודות דיפלומטיים.</strong><br>המידע המוצג אינו מהווה בסיס לקבלת החלטות ביטחוניות או פיננסיות.`
        },
        // Add FR/RU if needed
    };

    function setLang(lang) {
        // Fallback to EN if language not full defined
        const t = i18n[lang] || i18n.en;
        document.body.dir = (lang === 'he') ? 'rtl' : 'ltr';
        
        // Update flags UI
        document.querySelectorAll('.lang-flags img').forEach(i => i.classList.remove('active'));
        event.target.classList.add('active');

        // Apply Text
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if(t[key]) el.innerHTML = t[key]; // Use innerHTML to allow <br> tags
        });

        // Update Placeholder
        document.getElementById('newComm').placeholder = (lang === 'he') ? "כתוב דיווח אנונימי..." : "Enter anonymous report...";
    }

    // --- 2. LIVE RSS FETCH (Ynet + CNN) ---
    async function fetchRSS() {
        const ticker = document.getElementById('rss-feed-content');
        ticker.innerHTML = '<span class="rss-item">Loading live satellite feeds...</span>';
        
        // Using rss2json to bypass CORS restrictions on GitHub Pages
        const ynetURL = 'https://api.rss2json.com/v1/api.json?rss_url=http://www.ynet.co.il/Integration/StoryRss1854.xml';
        const cnnURL = 'https://api.rss2json.com/v1/api.json?rss_url=http://rss.cnn.com/rss/edition.rss';

        try {
            const [ynetRes, cnnRes] = await Promise.all([
                fetch(ynetURL).then(res => res.json()),
                fetch(cnnURL).then(res => res.json())
            ]);

            let newsItems = [];

            // Process Ynet (Hebrew)
            if(ynetRes.status === 'ok') {
                ynetRes.items.slice(0, 5).forEach(item => {
                    newsItems.push(`<b>YNET:</b> ${item.title}`);
                });
            }

            // Process CNN (English)
            if(cnnRes.status === 'ok') {
                cnnRes.items.slice(0, 5).forEach(item => {
                    newsItems.push(`<b>CNN:</b> ${item.title}`);
                });
            }

            // Fallback if APIs fail
            if(newsItems.length === 0) {
                newsItems = [
                    "<b>SYSTEM:</b> Unable to fetch live RSS. Using backup datalink.",
                    "<b>ALERT:</b> High traffic detected on northern border roads.",
                    "<b>INFO:</b> Diplomatic talks continuing in Cairo."
                ];
            }

            // Display
            ticker.innerHTML = newsItems.map(t => `<span class="rss-item">${t}</span>`).join('');

        } catch (e) {
            console.error("RSS Error", e);
            ticker.innerHTML = '<span class="rss-item"><b>SYSTEM:</b> RSS Uplink Offline. Monitoring local sensors.</span>';
        }
    }
    fetchRSS(); // Run on load

    // --- 3. RISK ALGORITHM ---
    setTimeout(() => {
        const risk = 58; // Calculated score
        document.getElementById('riskPercent').innerText = risk + "%";
        const deg = (risk * 1.8) - 90;
        document.getElementById('mainNeedle').style.transform = `rotate(${deg}deg)`;
        
        let label = "MODERATE TENSION";
        let color = "#ffb700";
        if(risk > 75) { label = "HIGH RISK"; color = "#ff3333"; }
        const txt = document.getElementById('riskText');
        txt.innerText = label;
        txt.style.color = color;
    }, 800);

    // --- 4. POLLS ---
    const pollsData = [
        { q: "Escalation in 48h?", y: 15, n: 65, u: 20 },
        { q: "GPS Jamming nearby?", y: 88, n: 12, u: 0 }
    ];
    const pollContainer = document.getElementById('polls-container');
    pollsData.forEach((p, i) => {
        pollContainer.innerHTML += `
            <div class="poll-item" id="poll-${i}">
                <span class="poll-q">${p.q}</span>
                <div class="poll-opts">
                    <button class="poll-btn" onclick="document.getElementById('res-${i}').style.display='block';this.parentElement.style.display='none'">YES</button>
                    <button class="poll-btn" onclick="document.getElementById('res-${i}').style.display='block';this.parentElement.style.display='none'">NO</button>
                </div>
                <div class="poll-res" id="res-${i}">
                    <div class="res-bar"><div style="width:${p.y}%; background:#ff3333"></div><div style="width:${p.n}%; background:#00ce7c"></div></div>
                    <div style="font-size:0.8rem; color:#aaa; margin-top:5px;">Yes: ${p.y}% | No: ${p.n}%</div>
                </div>
            </div>`;
    });

    // --- 5. CHATTER FEED ---
    const feed = document.getElementById('feed');
    const msgs = ["GPS unstable.", "All clear in Eilat.", "Pizza index normal.", "Any news on flights?"];
    msgs.forEach(m => addComment("Anon", m));

    function addComment(name, text) {
        const div = document.createElement('div');
        div.className = 'comment';
        div.innerHTML = `<div class="c-meta"><span>${name}</span><span>Just now</span></div><div>${text}</div>`;
        feed.prepend(div);
    }
    
    function postComment() {
        const inp = document.getElementById('newComm');
        if(inp.value) { addComment("You", inp.value); inp.value = ""; }
    }
    
    // Auto-update feed
    setInterval(() => {
        addComment("System", "Scanning OSINT sources...");
    }, 15000);

    // --- 6. TIMERS ---
    let timeLeft = 1800;
    setInterval(() => {
        timeLeft--;
        if(timeLeft < 0) timeLeft = 1800;
        const m = Math.floor(timeLeft / 60).toString().padStart(2,'0');
        const s = (timeLeft % 60).toString().padStart(2,'0');
        document.getElementById('nextScan').innerText = `${m}:${s}`;
        document.getElementById('lastUpdate').innerText = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    }, 1000);

    // --- 7. CHARTS ---
    for(let i=1; i<=8; i++) {
        new Chart(document.getElementById('c'+i), {
            type: 'line',
            data: { labels: Array(20).fill(''), datasets: [{data:Array.from({length:20},()=>Math.random()*100), borderColor:'#ffb700', borderWidth:2, pointRadius:0, tension:0.4}] },
            options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{display:false},y:{display:false}} }
        });
    }
</script>
</body>
</html>
