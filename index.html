<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WARADAR | iOS Style Intel</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            /* iOS Dark Mode Palette */
            --bg: #000000;
            --card: #1c1c1e;
            --card-border: #2c2c2e;
            --text-primary: #ffffff;
            --text-secondary: #8e8e93;
            --accent-blue: #0a84ff;
            --accent-green: #30d158;
            --accent-red: #ff453a;
            --accent-orange: #ff9f0a;
            --accent-yellow: #ffd60a;
            --separator: #38383a;
        }

        body {
            background-color: var(--bg);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 0;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
            padding-bottom: 60px;
        }

        /* --- HEADER --- */
        header {
            padding: 20px;
            background: rgba(28, 28, 30, 0.8);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            position: sticky; top: 0; z-index: 100;
            border-bottom: 0.5px solid var(--separator);
            display: flex; justify-content: space-between; align-items: center;
        }

        .app-title {
            font-size: 22px; font-weight: 700; letter-spacing: -0.5px;
            display: flex; align-items: center; gap: 8px;
        }

        .header-actions { display: flex; gap: 15px; }
        .icon-btn { color: var(--accent-blue); font-size: 1.2rem; cursor: pointer; transition: 0.2s; }
        .icon-btn:hover { opacity: 0.7; }

        .donate-pill {
            background: var(--accent-blue); color: white;
            padding: 6px 14px; border-radius: 20px;
            font-size: 13px; font-weight: 600; text-decoration: none;
        }

        /* --- CONTAINER --- */
        .container { max-width: 1000px; margin: 20px auto; padding: 0 20px; }

        /* --- DUAL RISK GAUGE (HERO SECTION) --- */
        .risk-hero {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px;
        }
        
        .hero-card {
            background: var(--card); border-radius: 22px; padding: 20px;
            display: flex; flex-direction: column; align-items: center; text-align: center;
            position: relative; overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .ring-container {
            width: 120px; height: 120px; position: relative; margin: 15px 0;
        }
        .ring-svg { transform: rotate(-90deg); width: 100%; height: 100%; }
        .ring-circle-bg { fill: none; stroke: #2c2c2e; stroke-width: 8; }
        .ring-circle-fg { 
            fill: none; stroke-width: 8; stroke-linecap: round; 
            stroke-dasharray: 339.29; stroke-dashoffset: 339.29; 
            transition: stroke-dashoffset 1.5s ease-out;
        }
        .ring-text {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 26px; font-weight: 700; font-variant-numeric: tabular-nums;
        }

        .hero-title { font-size: 15px; font-weight: 600; color: var(--text-secondary); }
        .hero-status { font-size: 17px; font-weight: 700; margin-top: 5px; letter-spacing: -0.3px; }

        /* --- WIDGET GRID (iOS Style) --- */
        .widget-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 15px;
        }

        .widget {
            background: var(--card); border-radius: 20px; padding: 16px;
            display: flex; flex-direction: column; justify-content: space-between;
            aspect-ratio: 1 / 1; /* Square widgets like iOS */
            transition: transform 0.2s; cursor: default;
        }
        .widget:active { transform: scale(0.98); }

        .widget-header { display: flex; justify-content: space-between; align-items: flex-start; }
        
        .icon-box {
            width: 32px; height: 32px; border-radius: 8px;
            display: flex; justify-content: center; align-items: center;
            color: white; font-size: 16px;
        }

        .widget-val { font-size: 24px; font-weight: 700; margin: 5px 0; letter-spacing: -0.5px; }
        .widget-label { font-size: 13px; font-weight: 500; color: var(--text-secondary); line-height: 1.2; }
        
        .chart-mini { height: 40px; width: 100%; margin-top: auto; opacity: 0.8; }

        /* --- SECTION TITLES --- */
        .section-header {
            font-size: 20px; font-weight: 700; margin: 40px 0 15px 5px;
            display: flex; justify-content: space-between; align-items: flex-end;
        }
        .last-updated { font-size: 13px; color: var(--text-secondary); font-weight: 400; }

        /* --- NEWS LIST (iOS Settings Style) --- */
        .news-list {
            background: var(--card); border-radius: 18px; overflow: hidden;
        }
        .news-item {
            padding: 16px; border-bottom: 0.5px solid var(--separator);
            display: flex; flex-direction: column; gap: 4px;
        }
        .news-item:last-child { border-bottom: none; }
        .news-source { font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; }
        .news-headline { font-size: 15px; font-weight: 500; line-height: 1.4; }

        /* --- FOOTER --- */
        .footer {
            text-align: center; margin-top: 50px; color: var(--text-secondary); font-size: 12px;
        }
        .footer a { color: var(--text-secondary); text-decoration: none; }

        /* --- RTL SUPPORT --- */
        body[dir="rtl"] { font-family: -apple-system, BlinkMacSystemFont, "Heebo", sans-serif; }
        body[dir="rtl"] .hero-card { direction: rtl; }

        /* --- RESPONSIVE --- */
        @media (max-width: 600px) {
            .widget { aspect-ratio: auto; height: 160px; }
        }
    </style>
</head>
<body dir="ltr">

<header>
    <div class="app-title">
        <i class="fas fa-layer-group" style="color:var(--accent-blue)"></i> WARADAR
    </div>
    <div class="header-actions">
        <div class="lang-switch" style="cursor: pointer;" onclick="toggleLang()">
            <i class="fas fa-globe"></i>
        </div>
        <a href="https://buymeacoffee.com/idanbit1" target="_blank" class="donate-pill" id="btnDonate">Donate</a>
    </div>
</header>

<div class="container">

    <div class="section-header">
        <span id="txtThreat">Threat Analysis</span>
        <span class="last-updated" id="lastUpdate">Updated: Just now</span>
    </div>

    <div class="risk-hero">
        <div class="hero-card">
            <div class="hero-title" id="lblUsIran">US-Iran Escalation</div>
            <div class="ring-container">
                <svg class="ring-svg">
                    <circle cx="60" cy="60" r="54" class="ring-circle-bg"></circle>
                    <circle cx="60" cy="60" r="54" class="ring-circle-fg" id="ring1" stroke="#ff9f0a"></circle>
                </svg>
                <div class="ring-text" id="valUsIran">0%</div>
            </div>
            <div class="hero-status" id="statUsIran" style="color:var(--accent-orange)">Calculating...</div>
        </div>

        <div class="hero-card">
            <div class="hero-title" id="lblIlImpact">Israel Risk Impact</div>
            <div class="ring-container">
                <svg class="ring-svg">
                    <circle cx="60" cy="60" r="54" class="ring-circle-bg"></circle>
                    <circle cx="60" cy="60" r="54" class="ring-circle-fg" id="ring2" stroke="#ff453a"></circle>
                </svg>
                <div class="ring-text" id="valIlImpact">0%</div>
            </div>
            <div class="hero-status" id="statIlImpact" style="color:var(--accent-red)">Calculating...</div>
        </div>
    </div>

    <div class="section-header" id="txtIntel">Live Intelligence</div>
    
    <div class="widget-grid">
        <div class="widget">
            <div class="widget-header">
                <div class="icon-box" style="background:var(--accent-orange)"><i class="fas fa-plane"></i></div>
                <i class="fas fa-arrow-up" style="color:var(--accent-orange); font-size:12px;"></i>
            </div>
            <div>
                <div class="widget-val">62%</div>
                <div class="widget-label" id="lblTanker">Mil. Tankers</div>
            </div>
            <div class="chart-mini"><canvas id="c1"></canvas></div>
        </div>

        <div class="widget">
            <div class="widget-header">
                <div class="icon-box" style="background:var(--accent-red)"><i class="fas fa-location-slash"></i></div>
                <i class="fas fa-exclamation" style="color:var(--accent-red); font-size:12px;"></i>
            </div>
            <div>
                <div class="widget-val">95%</div>
                <div class="widget-label" id="lblGps">GPS Jamming</div>
            </div>
            <div class="chart-mini"><canvas id="c2"></canvas></div>
        </div>

        <div class="widget">
            <div class="widget-header">
                <div class="icon-box" style="background:var(--accent-blue)"><i class="fas fa-plane-slash"></i></div>
            </div>
            <div>
                <div class="widget-val">30%</div>
                <div class="widget-label" id="lblFlight">Flight Cancels</div>
            </div>
            <div class="chart-mini"><canvas id="c3"></canvas></div>
        </div>

        <div class="widget">
            <div class="widget-header">
                <div class="icon-box" style="background:var(--accent-yellow)"><i class="fas fa-pizza-slice"></i></div>
            </div>
            <div>
                <div class="widget-val">High</div>
                <div class="widget-label" id="lblPizza">Pentagon Pizza</div>
            </div>
            <div class="chart-mini"><canvas id="c4"></canvas></div>
        </div>

        <div class="widget">
            <div class="widget-header">
                <div class="icon-box" style="background:var(--accent-green)"><i class="fas fa-chart-line"></i></div>
            </div>
            <div>
                <div class="widget-val">18%</div>
                <div class="widget-label" id="lblMarket">Market Odds</div>
            </div>
            <div class="chart-mini"><canvas id="c5"></canvas></div>
        </div>

        <div class="widget">
            <div class="widget-header">
                <div class="icon-box" style="background:#5856d6"><i class="fas fa-newspaper"></i></div>
            </div>
            <div>
                <div class="widget-val">Neg</div>
                <div class="widget-label" id="lblNews">Sentiment</div>
            </div>
            <div class="chart-mini"><canvas id="c6"></canvas></div>
        </div>

        <div class="widget">
            <div class="widget-header">
                <div class="icon-box" style="background:#5ac8fa"><i class="fas fa-cloud"></i></div>
            </div>
            <div>
                <div class="widget-val" id="valWeather">Clear</div>
                <div class="widget-label" id="lblWeather">Op. Weather</div>
            </div>
            <div class="chart-mini"><canvas id="c7"></canvas></div>
        </div>

        <div class="widget">
            <div class="widget-header">
                <div class="icon-box" style="background:#8e8e93"><i class="fas fa-search"></i></div>
            </div>
            <div>
                <div class="widget-val">Normal</div>
                <div class="widget-label" id="lblWiki">Public Interest</div>
            </div>
            <div class="chart-mini"><canvas id="c8"></canvas></div>
        </div>
    </div>

    <div class="section-header" id="txtNews">Latest Updates</div>
    <div class="news-list" id="newsFeed">
        </div>

    <div class="footer">
        Created by <a href="#">Idan Biton</a> | Based on OSINT Data.<br>
        Not official military intelligence.
    </div>

</div>

<script>
    // --- 1. CONFIG & DATA ---
    const params = {
        tanker: 62, gps: 95, flight: 30, pizza: 75, market: 18, news: 65, weather: 85, wiki: 28
    };

    // --- 2. DUAL RISK ALGORITHM ---
    function calculateRisks() {
        // Algorithm 1: US-Iran Escalation Probability
        // Heavily weighted on Tankers (Offensive) + Market + Pizza + News
        const usRisk = Math.floor(
            (params.tanker * 0.4) + 
            (params.market * 0.2) + 
            (params.news * 0.2) + 
            (params.pizza * 0.2)
        );

        // Algorithm 2: Israel Impact Risk
        // Heavily weighted on GPS (Defensive) + Flights + US_Risk spillover
        const ilRisk = Math.floor(
            (params.gps * 0.5) + 
            (params.flight * 0.3) + 
            (usRisk * 0.2)
        );

        updateGauge('ring1', 'valUsIran', 'statUsIran', usRisk);
        updateGauge('ring2', 'valIlImpact', 'statIlImpact', ilRisk);
    }

    function updateGauge(ringId, valId, statId, percentage) {
        // Update Text
        document.getElementById(valId).innerText = percentage + "%";
        
        // Update Ring Stroke (Circumference ~339)
        const offset = 339.29 - (339.29 * percentage) / 100;
        const ring = document.getElementById(ringId);
        ring.style.strokeDashoffset = offset;

        // Update Status & Color
        let status = "Routine";
        let color = "var(--accent-green)";
        
        if(percentage > 40) { status = "Elevated"; color = "var(--accent-yellow)"; }
        if(percentage > 60) { status = "High Tension"; color = "var(--accent-orange)"; }
        if(percentage > 80) { status = "Critical"; color = "var(--accent-red)"; }

        document.getElementById(statId).innerText = status;
        document.getElementById(statId).style.color = color;
        ring.style.stroke = color;
    }

    // --- 3. CHARTS (IOS SPARKLINE STYLE) ---
    Chart.defaults.scale.grid.display = false;
    
    function initCharts() {
        const commonConfig = {
            type: 'line',
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: {display:false}, tooltip: {enabled: true, mode: 'index', intersect: false} },
                scales: { x: {display:false}, y: {display:false} },
                elements: { point: {radius: 0, hitRadius: 10}, line: {tension: 0.4, borderWidth: 2} }
            }
        };

        const chartColors = [
            '#ff9f0a', '#ff453a', '#0a84ff', '#ffd60a', 
            '#30d158', '#5856d6', '#5ac8fa', '#8e8e93'
        ];

        for(let i=1; i<=8; i++) {
            const ctx = document.getElementById('c'+i).getContext('2d');
            // Generate mock smooth data
            let data = [];
            let curr = 50;
            for(let j=0; j<15; j++) {
                curr += (Math.random() - 0.5) * 20;
                data.push(curr);
            }

            new Chart(ctx, {
                ...commonConfig,
                data: {
                    labels: Array(15).fill(''),
                    datasets: [{
                        data: data,
                        borderColor: chartColors[i-1],
                        backgroundColor: 'transparent', // Minimal look
                        fill: false
                    }]
                }
            });
        }
    }

    // --- 4. NEWS SIMULATOR ---
    async function loadNews() {
        // Fallback simulated news if CORS blocks real RSS
        const news = [
            { src: "CNN", text: "Pentagon monitoring increased drone activity." },
            { src: "YNET", text: "Home Front Command: No change in instructions." },
            { src: "REUTERS", text: "Diplomats scramble to ease regional tensions." },
            { src: "AP", text: "Satellite images show movement at airbases." }
        ];

        const container = document.getElementById('newsFeed');
        container.innerHTML = news.map(n => `
            <div class="news-item">
                <span class="news-source">${n.src}</span>
                <span class="news-headline">${n.text}</span>
            </div>
        `).join('');
    }

    // --- 5. TRANSLATIONS & RTL ---
    let currentLang = 'en';
    const dict = {
        en: {
            txtThreat: "Threat Analysis", lblUsIran: "US-Iran Escalation", lblIlImpact: "Israel Risk Impact",
            txtIntel: "Live Intelligence", txtNews: "Latest Updates",
            lblTanker: "Mil. Tankers", lblGps: "GPS Jamming", lblFlight: "Flight Cancels",
            lblPizza: "Pentagon Pizza", lblMarket: "Market Odds", lblNews: "Sentiment",
            lblWeather: "Op. Weather", lblWiki: "Public Interest"
        },
        he: {
            txtThreat: "ניתוח איומים", lblUsIran: "הסלמה ארה\"ב-איראן", lblIlImpact: "השפעת סיכון על ישראל",
            txtIntel: "מודיעין זמן-אמת", txtNews: "עדכונים אחרונים",
            lblTanker: "מיכליות תדלוק", lblGps: "שיבושי GPS", lblFlight: "ביטולי טיסות",
            lblPizza: "מדד הפיצה", lblMarket: "סיכויי שוק", lblNews: "סנטימנט חדשות",
            lblWeather: "מזג אוויר מבצעי", lblWiki: "עניין הציבור"
        }
    };

    function toggleLang() {
        currentLang = currentLang === 'en' ? 'he' : 'en';
        document.body.dir = currentLang === 'he' ? 'rtl' : 'ltr';
        
        const t = dict[currentLang];
        for (const [key, value] of Object.entries(t)) {
            const el = document.getElementById(key);
            if(el) el.innerText = value;
        }
    }

    // --- INIT ---
    setTimeout(calculateRisks, 500); // Simulate calculation delay
    initCharts();
    loadNews();
    
    // Timer
    setInterval(() => {
        document.getElementById('lastUpdate').innerText = "Updated: " + new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    }, 10000);

</script>
</body>
</html>
