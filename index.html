<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WARADAR - Strategic Risk Monitor</title>
    <style>
        :root {
            --primary: #00ff41; /* Cyber Green */
            --warning: #ffb700; /* Alert Orange */
            --danger: #ff3333;  /* War Red */
            --telegram: #0088cc; /* Telegram Blue */
            --bg: #050505;      /* Void Black */
            --panel: #0f1215;
            --text-dim: #888;
            --hover-row: #1a221a;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            background-color: var(--bg);
            color: var(--primary);
            font-family: 'Segoe UI', 'Roboto Mono', monospace;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Scanline Overlay */
        body::after {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px);
            pointer-events: none;
            z-index: 990;
        }

        /* --- HEADER --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(0, 20, 0, 0.95);
            border-bottom: 1px solid var(--primary);
            backdrop-filter: blur(5px);
            z-index: 1000;
            position: sticky; top: 0;
        }

        .brand { display: flex; align-items: center; gap: 15px; }
        .radar-logo {
            width: 40px; height: 40px; border: 2px solid var(--primary);
            border-radius: 50%; position: relative;
            background: radial-gradient(circle, rgba(0,255,65,0.1), transparent);
        }
        .radar-sweep {
            position: absolute; width: 50%; height: 50%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 65, 0.5));
            top: 0; left: 0; transform-origin: bottom right;
            animation: sweep 2s infinite linear; border-radius: 100% 0 0 0;
        }
        @keyframes sweep { to { transform: rotate(360deg); } }

        .title-group h1 { margin: 0; font-size: 1.5rem; letter-spacing: 2px; text-transform: uppercase; }
        .live-tag { font-size: 0.7rem; background: var(--danger); color: white; padding: 2px 5px; border-radius: 3px; animation: blink 1s infinite; }

        .top-controls { display: flex; gap: 10px; align-items: center; }
        .clock { font-family: 'Courier New', monospace; font-weight: bold; font-size: 1.1rem; display: none; margin-right: 10px; }
        @media(min-width: 700px) { .clock { display: block; } }

        .lang-flags { display: flex; gap: 8px; cursor: pointer; margin-left: 5px; }
        .flag { font-size: 1.5rem; filter: grayscale(1); transition: 0.3s; }
        .flag:hover, .flag.active { filter: grayscale(0); transform: scale(1.2); }

        /* Buttons */
        .btn {
            text-decoration: none; padding: 5px 12px; font-weight: bold; border-radius: 4px; 
            display: flex; align-items: center; gap: 6px; font-size: 0.8rem; transition: 0.3s;
        }
        .donate-btn {
            background: #FFDD00; color: #000; border: 1px solid #cca300;
        }
        .donate-btn:hover { background: #ffe600; box-shadow: 0 0 10px #FFDD00; }

        .telegram-btn {
            background: transparent; color: var(--telegram); border: 1px solid var(--telegram);
        }
        .telegram-btn:hover { background: rgba(0, 136, 204, 0.2); box-shadow: 0 0 10px var(--telegram); }
        .telegram-icon { width: 14px; height: 14px; fill: currentColor; }

        /* --- LAYOUT --- */
        main {
            flex: 1; padding: 20px; display: grid; grid-template-columns: 1fr 1.2fr;
            gap: 20px; max-width: 1400px; margin: 0 auto; width: 100%;
        }
        @media (max-width: 900px) { main { grid-template-columns: 1fr; } }

        .card {
            background: var(--panel); border: 1px solid #333; padding: 20px;
            border-radius: 4px; position: relative; display: flex; flex-direction: column;
        }
        .card h2 {
            margin-top: 0; border-bottom: 1px solid #333; padding-bottom: 10px;
            font-size: 1.1rem; color: var(--text-dim); text-transform: uppercase;
            display: flex; justify-content: space-between; align-items: center;
        }

        /* --- SCORE & CHART --- */
        .score-container { text-align: center; padding: 10px; margin-bottom: 20px; }
        .big-score { font-size: 5rem; font-weight: 900; color: var(--primary); text-shadow: 0 0 20px rgba(0,255,65,0.4); line-height: 1; }
        
        /* Stock Graph Canvas */
        .history-section {
            margin-top: auto;
            border-top: 1px dashed #333;
            padding-top: 15px;
            position: relative;
        }
        canvas#trendChart {
            width: 100%; height: 150px; margin-top: 10px; display: block;
        }
        .chart-labels {
            display: flex; justify-content: space-between; font-size: 0.7rem; color: #666; margin-top: 5px; padding: 0 5px;
        }

        /* --- PARAMETERS LIST --- */
        .parameter-row {
            margin-bottom: 12px; padding: 10px; border-radius: 4px;
            border: 1px solid transparent; transition: 0.2s; cursor: pointer;
        }
        .parameter-row:hover { background: var(--hover-row); border-color: #333; }
        
        .param-header { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.9rem; align-items: center; }
        .param-label { display: flex; align-items: center; gap: 10px; font-weight: bold; }
        
        /* SVG Icons Styling */
        .param-icon {
            width: 20px; height: 20px; fill: var(--primary); opacity: 0.8; transition: 0.3s;
        }
        .parameter-row:hover .param-icon { transform: scale(1.1); opacity: 1; }

        .info-btn {
            display: inline-flex; align-items: center; justify-content: center;
            width: 18px; height: 18px; border: 1px solid var(--text-dim);
            color: var(--text-dim); border-radius: 50%; font-size: 0.7rem;
            cursor: pointer; transition: 0.2s; z-index: 5; margin-left: auto;
        }
        .info-btn:hover { color: var(--primary); border-color: var(--primary); background: rgba(0,255,65,0.1); }

        .progress-bg { background: #222; height: 6px; width: 100%; border-radius: 3px; overflow: hidden; margin-top: 5px; }
        .progress-fill {
            height: 100%; width: 0%;
            background: linear-gradient(90deg, var(--primary), var(--warning));
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(4px);
            z-index: 2000; display: none; align-items: center; justify-content: center;
        }
        .modal-overlay.open { display: flex; }
        .modal-box {
            background: #111; border: 1px solid var(--primary); width: 90%; max-width: 500px;
            padding: 25px; box-shadow: 0 0 40px rgba(0, 255, 65, 0.15); position: relative;
        }
        .modal-close { position: absolute; top: 10px; right: 15px; font-size: 1.5rem; cursor: pointer; color: #888; }
        .modal-title { font-size: 1.2rem; color: var(--primary); border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; }
        .modal-content { font-size: 0.9rem; line-height: 1.6; color: #ccc; }
        .modal-tag { display: inline-block; background: #222; padding: 2px 6px; border-radius: 3px; font-size: 0.75rem; color: var(--warning); margin-top: 10px; border: 1px solid #444; }

        /* --- FOOTER --- */
        footer { text-align: center; padding: 20px; font-size: 0.8rem; color: #555; border-top: 1px solid #222; margin-top: auto; }
        .share-btn {
            background: transparent; border: 1px solid var(--primary); color: var(--primary);
            padding: 8px 20px; cursor: pointer; margin: 10px auto; display: inline-flex; align-items: center; gap: 8px;
        }
        .blink { animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        .rtl { direction: rtl; }
        .rtl .param-label { gap: 10px; }
        .rtl .info-btn { margin-right: auto; margin-left: 0; }
    </style>
</head>
<body>

    <header>
        <div class="brand">
            <div class="radar-logo"><div class="radar-sweep"></div></div>
            <div class="title-group">
                <h1>WARADAR <span class="live-tag">LIVE</span></h1>
            </div>
        </div>
        <div class="top-controls">
            <div class="clock" id="clock">00:00:00</div>
            
            <a href="https://t.me/waradarlive" target="_blank" class="btn telegram-btn">
                <svg class="telegram-icon" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.3l15.97-6.16c.73-.33 1.43.18 1.15 1.3l-2.72 12.81c-.19.91-.74 1.13-1.5.71L12.6 16.3l-1.99 1.93c-.23.23-.42.42-.83.42z"/></svg>
                <span data-key="telegram">Join</span>
            </a>

            <a href="https://buymeacoffee.com/idanbit1" target="_blank" class="btn donate-btn"><span>â˜•</span> <span data-key="donate">Donate</span></a>
            
            <div class="lang-flags">
                <span class="flag active" onclick="setLang('en')" title="English">ðŸ‡ºðŸ‡¸</span>
                <span class="flag" onclick="setLang('he')" title="×¢×‘×¨×™×ª">ðŸ‡®ðŸ‡±</span>
                <span class="flag" onclick="setLang('ru')" title="Ð ÑƒÑÑÐºÐ¸Ð¹">ðŸ‡·ðŸ‡º</span>
            </div>
        </div>
    </header>

    <main>
        <div class="card">
            <h2>
                <span data-key="escalation_probability">RISK SCORE</span>
                <span class="info-btn" onclick="openModal('general', event)">?</span>
            </h2>
            <div class="score-container">
                <div class="big-score" id="mainScore">--%</div>
                <div style="font-size: 1.2rem; margin-top: 10px;">
                    <span data-key="status">RISK LEVEL:</span> 
                    <span id="statusText" style="color: var(--warning)">CALCULATING...</span>
                </div>
                <div id="multiplierBadge" style="display:none; margin-top:15px; color: var(--danger); font-size: 0.8rem; border: 1px solid var(--danger); padding: 5px; display: inline-block;">
                    âš  ESCALATION MULTIPLIER ACTIVE
                </div>
            </div>

            <div class="history-section">
                <h3 style="font-size: 0.8rem; color: #888; margin: 0 0 5px 0; text-transform:uppercase;" data-key="trend_title">7-Day Risk Trend</h3>
                <canvas id="trendChart"></canvas>
                <div class="chart-labels">
                    <span>-7d</span>
                    <span>-48h</span>
                    <span>-24h</span>
                    <span>-12h</span>
                    <span>-3h</span>
                    <span class="blink">LIVE</span>
                </div>
            </div>
        </div>

        <div class="card">
            <h2 data-key="risk_parameters">LIVE SIGNALS</h2>
            <div id="parametersList">
                </div>
            <div style="margin-top: 15px; font-size: 0.8rem; color: #666; text-align: center;">
                <span data-key="click_hint">ðŸ’¡ TIP: Click any signal to verify source data</span>
            </div>
        </div>
    </main>

    <div class="modal-overlay" id="infoModal" onclick="closeModal(event)">
        <div class="modal-box">
            <span class="modal-close" onclick="closeModal(event, true)">Ã—</span>
            <div class="modal-title" id="mTitle">Title</div>
            <div class="modal-content" id="mContent">Content</div>
        </div>
    </div>

    <footer>
        <button class="share-btn" onclick="shareSite()">
            <span data-key="share">Share Status</span>
        </button>
        <div style="margin-top: 10px;">
            <a href="https://t.me/waradarlive" target="_blank" style="color: var(--telegram); text-decoration: none; font-size: 0.9rem;">
                ðŸ“¢ <span data-key="telegram_footer">Join our Telegram Channel</span>
            </a>
        </div>
        <div class="disclaimer-box" style="opacity: 0.7; margin-top:10px;">
            <span data-key="disclaimer_short">Open-source intel aggregation. Not official military advice.</span>
        </div>
        <div style="margin-top: 10px; color: #444;">Created by <strong style="color: #666;">Idan Biton</strong></div>
    </footer>

    <script>
        // --- ICONS (SVG) ---
        const icons = {
            news: '<svg class="param-icon" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>',
            aviation: '<svg class="param-icon" viewBox="0 0 24 24"><path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/></svg>',
            tankers: '<svg class="param-icon" viewBox="0 0 24 24"><path d="M12 2L2 22h20L12 2zm0 3.5L18.5 19H5.5L12 5.5z"/></svg>',
            market: '<svg class="param-icon" viewBox="0 0 24 24"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/></svg>',
            financial: '<svg class="param-icon" viewBox="0 0 24 24"><path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/></svg>',
            social: '<svg class="param-icon" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>',
            traffic: '<svg class="param-icon" viewBox="0 0 24 24"><path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.85 7h10.29l1.08 3.11H5.77L6.85 7zM19 17H5v-5h14v5z"/></svg>',
            pentagon: '<svg class="param-icon" viewBox="0 0 24 24"><path d="M12 2L2 9l4 13h12l4-13-10-7zm0 3.5L18.5 10l-2.5 8h-8L5.5 10 12 5.5z"/></svg>',
            weather: '<svg class="param-icon" viewBox="0 0 24 24"><path d="M19.36 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.64-4.96z"/></svg>'
        };

        // --- CONFIGURATION ---
        const signalsConfig = [
            { id: 'news',     weight: 0.20, url: 'https://www.google.com/search?q=Iran+US+War+news&tbm=nws', baseVal: 45, icon: icons.news },
            { id: 'aviation', weight: 0.15, url: 'https://www.flightradar24.com/32.57,53.05/5', baseVal: 30, icon: icons.aviation },
            { id: 'market',   weight: 0.15, url: 'https://polymarket.com/markets?q=Iran', baseVal: 55, icon: icons.market },
            { id: 'financial',weight: 0.15, url: 'https://www.tradingview.com/symbols/TVC-USOIL/', baseVal: 60, icon: icons.financial },
            { id: 'tankers',  weight: 0.10, url: 'https://www.flightradar24.com/multiview/32.57,53.05/5', baseVal: 65, icon: icons.tankers },
            { id: 'social',   weight: 0.10, url: 'https://twitter.com/search?q=Iran+USA+military&f=live', baseVal: 70, icon: icons.social },
            { id: 'traffic',  weight: 0.05, url: 'https://www.google.com/maps/@35.6997327,51.3380436,11.5z/data=!5m1!1e1', baseVal: 40, icon: icons.traffic },
            { id: 'pentagon', weight: 0.05, url: 'https://www.google.com/maps/@38.8718568,-77.056266,15z/data=!5m1!1e1', baseVal: 20, icon: icons.pentagon },
            { id: 'weather',  weight: 0.05, url: 'https://www.windy.com/35.689/51.389?35.195,51.389,8', baseVal: 80, icon: icons.weather }
        ];

        // --- FIXED HISTORICAL DATA ---
        const historyPoints = [35, 42, 58, 52, 60]; 

        // --- CONTENT DICTIONARY ---
        const content = {
            en: {
                donate: "Donate",
                telegram: "Channel",
                telegram_footer: "Join our Telegram Channel",
                escalation_probability: "TOTAL RISK SCORE",
                status: "RISK LEVEL:",
                click_hint: "ðŸ’¡ TIP: Click any signal to verify source data",
                risk_parameters: "LIVE SIGNALS & SOURCES",
                share: "Share Status",
                disclaimer_short: "Statistical aggregation. Use at your own discretion.",
                trend_title: "7-Day Risk Trend",
                
                l_news: "News Intelligence",
                l_aviation: "Civil Aviation",
                l_tankers: "US Tanker Activity",
                l_market: "Prediction Markets",
                l_financial: "Global Markets",
                l_social: "Social Intel / OSINT",
                l_traffic: "Tehran Traffic",
                l_pentagon: "Pentagon Activity",
                l_weather: "Weather (Tehran)",
                
                m_general_title: "Risk Calculation",
                m_general_desc: "We aggregate 9 distinct signals to calculate the probability of conflict.<br><br><strong>Why these weights?</strong><br>â€¢ News (20%) & Markets (15%) are leading indicators.<br>â€¢ Aviation (15%) reflects insurance risk.<br>â€¢ Tankers (10%) reflect logistical readiness.<br>The graph shows a fixed 7-day trend analysis.",
                
                m_news_desc: "Scans major news outlets for keywords like 'Strike', 'Imminent'.",
                m_aviation_desc: "Civilian flight volume over Iran. Low volume = High Risk.",
                m_tankers_desc: "Presence of KC-135/KC-46 refueling tankers.",
                m_market_desc: "Betting odds on war within 7 days.",
                m_financial_desc: "Brent Crude Oil, DXY, and Bitcoin volatility.",
                m_social_desc: "Real-time scraper of X (Twitter) and Telegram.",
                m_traffic_desc: "Google Maps traffic data in Tehran.",
                m_pentagon_desc: "Activity levels around US Defense Dept HQ.",
                m_weather_desc: "Visibility conditions for airstrikes."
            },
            he: {
                donate: "×ª×¨×•×ž×”",
                telegram: "×¢×¨×•×¥",
                telegram_footer: "×”×¦×˜×¨×¤×• ×œ×¢×¨×•×¥ ×”×˜×œ×’×¨× ×©×œ× ×•",
                escalation_probability: "×¦×™×•×Ÿ ×¡×™×›×•×Ÿ ×›×•×œ×œ",
                status: "×¨×ž×ª ×¡×™×›×•×Ÿ:",
                click_hint: "ðŸ’¡ ×˜×™×¤: ×œ×—×¥ ×¢×œ ×›×œ ×¤×¨×ž×˜×¨ ×›×“×™ ×œ×¤×ª×•×— ××ª ×ž×§×•×¨ ×”×ž×™×“×¢",
                risk_parameters: "××•×ª×•×ª ×•×ž×§×•×¨×•×ª ×ž×™×“×¢",
                share: "×©×ª×£ ×¡×˜×˜×•×¡",
                disclaimer_short: "××’×¨×’×¦×™×” ×¡×˜×˜×™×¡×˜×™×ª ×‘×œ×‘×“. ×”×©×™×ž×•×© ×‘××—×¨×™×•×ª×š.",
                trend_title: "×ž×’×ž×ª ×¡×™×›×•×Ÿ (7 ×™×ž×™×)",

                l_news: "×ž×•×“×™×¢×™×Ÿ ×—×“×©×•×ª×™",
                l_aviation: "×ª×¢×•×¤×” ××–×¨×—×™×ª",
                l_tankers: "×ž×›×œ×™×•×ª ×¦×‘××™×•×ª",
                l_market: "×©×•×§×™ ×—×™×–×•×™",
                l_financial: "×©×•×•×§×™× ×¤×™× × ×¡×™×™×",
                l_social: "×ž×•×“×™×¢×™×Ÿ ×¨×©×ª×•×ª",
                l_traffic: "×ª× ×•×¢×” ×‘×˜×”×¨×Ÿ",
                l_pentagon: "×¤×¢×™×œ×•×ª ×‘×¤× ×˜×’×•×Ÿ",
                l_weather: "×ž×–×’ ××•×•×™×¨",

                m_general_title: "×©×™×˜×ª ×—×™×©×•×‘",
                m_general_desc: "×”××œ×’×•×¨×™×ª× ×ž×©×§×œ×œ 9 ×ž×§×•×¨×•×ª. ×”×’×¨×£ ×ž×¦×™×’ ×ž×’×ž×” ×§×‘×•×¢×” ×©×œ 7 ×”×™×ž×™× ×”××—×¨×•× ×™× ×•×ž×ª×¢×“×›×Ÿ ×‘×–×ž×Ÿ ××ž×ª ×‘× ×§×•×“×” ×”××—×¨×•× ×” ×‘×œ×‘×“.",
                
                m_news_desc: "×¡×¨×™×§×ª ×›×•×ª×¨×•×ª ×‘××ª×¨×™ ×—×“×©×•×ª ×ž×•×‘×™×œ×™×.",
                m_aviation_desc: "× ×¤×— ×˜×™×¡×•×ª ×ž×¡×—×¨×™×•×ª ×ž×¢×œ ××™×¨××Ÿ.",
                m_tankers_desc: "× ×•×›×—×•×ª ×ž×ª×“×œ×§×™× ××•×•×™×¨×™×™×.",
                m_market_desc: "×¡×™×›×•×™×™ ×”×™×ž×•×¨×™× ×¢×œ ×ž×œ×—×ž×”.",
                m_financial_desc: "× ×™×ª×•×— ×ž×—×™×¨ × ×¤×˜, ×“×•×œ×¨ ×•×‘×™×˜×§×•×™×Ÿ.",
                m_social_desc: "× ×™×˜×•×¨ ×˜×•×•×™×˜×¨ ×•×˜×œ×’×¨×.",
                m_traffic_desc: "×ž×“×“ ×¢×•×ž×¡×™× ×‘×˜×”×¨×Ÿ.",
                m_pentagon_desc: "×¤×¢×™×œ×•×ª ×¡×‘×™×‘ ×”×¤× ×˜×’×•×Ÿ.",
                m_weather_desc: "×ª× ××™ ×¨××•×ª ×œ×ª×§×™×¤×”."
            },
            ru: {
                donate: "ÐŸÐ¾Ð¶ÐµÑ€Ñ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ",
                telegram: "ÐšÐ°Ð½Ð°Ð»",
                telegram_footer: "ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÑÐ¹Ñ‚ÐµÑÑŒ Ðº ÐºÐ°Ð½Ð°Ð»Ñƒ",
                escalation_probability: "ÐžÐ‘Ð©Ð˜Ð™ Ð Ð˜Ð¡Ðš",
                status: "Ð£Ð ÐžÐ’Ð•ÐÐ¬ Ð Ð˜Ð¡ÐšÐ:",
                click_hint: "ðŸ’¡ Ð¡ÐžÐ’Ð•Ð¢: ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ Ð´Ð»Ñ Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€Ð° Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ°",
                risk_parameters: "Ð¡Ð˜Ð“ÐÐÐ›Ð« Ð˜ Ð˜Ð¡Ð¢ÐžÐ§ÐÐ˜ÐšÐ˜",
                share: "ÐŸÐ¾Ð´ÐµÐ»Ð¸Ñ‚ÑŒÑÑ",
                disclaimer_short: "Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð°Ð³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ñ. ÐÐµ Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐ¾Ð²ÐµÑ‚.",
                trend_title: "Ð¢Ð Ð•ÐÐ” (7 Ð”ÐÐ•Ð™)",

                l_news: "ÐÐ½Ð°Ð»Ð¸Ð· Ð½Ð¾Ð²Ð¾ÑÑ‚ÐµÐ¹",
                l_aviation: "ÐÐ²Ð¸Ð°Ñ†Ð¸Ñ",
                l_tankers: "Ð’Ð¾ÐµÐ½Ð½Ñ‹Ðµ Ñ‚Ð°Ð½ÐºÐµÑ€Ñ‹",
                l_market: "Ð Ñ‹Ð½ÐºÐ¸ Ð¿Ñ€Ð¾Ð³Ð½Ð¾Ð·Ð¾Ð²",
                l_financial: "Ð¤Ð¸Ð½Ð°Ð½ÑÑ‹",
                l_social: "Ð¡Ð¾Ñ†ÑÐµÑ‚Ð¸",
                l_traffic: "Ð¢Ñ€Ð°Ñ„Ð¸Ðº Ð¢ÐµÐ³ÐµÑ€Ð°Ð½",
                l_pentagon: "ÐŸÐµÐ½Ñ‚Ð°Ð³Ð¾Ð½",
                l_weather: "ÐŸÐ¾Ð³Ð¾Ð´Ð°",

                m_general_title: "ÐœÐµÑ‚Ð¾Ð´Ð¾Ð»Ð¾Ð³Ð¸Ñ",
                m_general_desc: "ÐÐ³Ñ€ÐµÐ³Ð°Ñ†Ð¸Ñ 9 ÑÐ¸Ð³Ð½Ð°Ð»Ð¾Ð². Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ñ„Ð¸ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ñ‚Ñ€ÐµÐ½Ð´ Ð·Ð° 7 Ð´Ð½ÐµÐ¹.",
                
                m_news_desc: "ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¾Ð² Ð½Ð¾Ð²Ð¾ÑÑ‚ÐµÐ¹.",
                m_aviation_desc: "ÐžÐ±ÑŠÐµÐ¼ Ð³Ñ€Ð°Ð¶Ð´Ð°Ð½ÑÐºÐ¸Ñ… Ñ€ÐµÐ¹ÑÐ¾Ð².",
                m_tankers_desc: "ÐÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ Ð·Ð°Ð¿Ñ€Ð°Ð²Ñ‰Ð¸ÐºÐ¾Ð².",
                m_market_desc: "Ð¡Ñ‚Ð°Ð²ÐºÐ¸ Ð½Ð° Ð²Ð¾Ð¹Ð½Ñƒ.",
                m_financial_desc: "ÐÐµÑ„Ñ‚ÑŒ, Ð”Ð¾Ð»Ð»Ð°Ñ€, Ð‘Ð¸Ñ‚ÐºÐ¾Ð¹Ð½.",
                m_social_desc: "ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Twitter Ð¸ Telegram.",
                m_traffic_desc: "ÐŸÑ€Ð¾Ð±ÐºÐ¸ Ð² Ð¢ÐµÐ³ÐµÑ€Ð°Ð½Ðµ.",
                m_pentagon_desc: "ÐÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ ÐŸÐµÐ½Ñ‚Ð°Ð³Ð¾Ð½Ð°.",
                m_weather_desc: "ÐŸÐ¾Ð³Ð¾Ð´Ð½Ñ‹Ðµ ÑƒÑÐ»Ð¾Ð²Ð¸Ñ."
            }
        };

        let currentLang = 'en';
        let signalValues = {}; 
        let currentTotalScore = 0;

        // --- LOGIC ---
        function updateClock() {
            document.getElementById('clock').innerText = new Date().toLocaleTimeString('en-GB', { hour12: false });
        }
        setInterval(updateClock, 1000);
        
        function simulateData() {
            let totalWeightedScore = 0;
            let elevatedCount = 0;

            signalsConfig.forEach(sig => {
                if (!signalValues[sig.id]) signalValues[sig.id] = sig.baseVal;
                const flux = (Math.random() * 6) - 3; 
                let val = signalValues[sig.id] + flux;
                val = Math.max(0, Math.min(100, val));
                signalValues[sig.id] = val;

                totalWeightedScore += (val * sig.weight);
                if (val > 30) elevatedCount++;
            });

            if (elevatedCount >= 4) { 
                totalWeightedScore = totalWeightedScore * 1.15;
                document.getElementById('multiplierBadge').style.display = "inline-block";
            } else {
                document.getElementById('multiplierBadge').style.display = "none";
            }

            currentTotalScore = Math.min(100, totalWeightedScore);
            updateUI(currentTotalScore);
            drawStockChart(currentTotalScore);
        }

        function updateUI(score) {
            const scoreEl = document.getElementById('mainScore');
            scoreEl.innerText = score.toFixed(1) + '%';
            
            let color = '#00ff41'; let status = 'LOW';
            if(score > 30) { color = '#ffb700'; status = 'ELEVATED'; }
            if(score > 60) { color = '#ff3333'; status = 'HIGH'; }
            
            scoreEl.style.color = color;
            document.getElementById('statusText').innerText = status;
            document.getElementById('statusText').style.color = color;
            
            renderParams();
        }

        function renderParams() {
            const list = document.getElementById('parametersList');
            list.innerHTML = '';
            
            signalsConfig.forEach(sig => {
                const val = signalValues[sig.id];
                const label = content[currentLang][`l_${sig.id}`];
                
                let barColor = 'var(--primary)';
                if(val > 30) barColor = 'var(--warning)';
                if(val > 60) barColor = 'var(--danger)';

                const row = document.createElement('div');
                row.className = 'parameter-row';
                row.onclick = () => window.open(sig.url, '_blank');
                row.title = "Click to open live data source";

                row.innerHTML = `
                    <div class="param-header">
                        <div class="param-label">
                            ${sig.icon} ${label} 
                        </div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <span>${val.toFixed(1)}%</span>
                            <span class="info-btn" onclick="openModal('${sig.id}', event)">i</span>
                        </div>
                    </div>
                    <div class="progress-bg">
                        <div class="progress-fill" style="width: ${val}%; background: ${barColor};"></div>
                    </div>
                `;
                list.appendChild(row);
            });
        }

        // --- STOCK GRAPH LOGIC ---
        function drawStockChart(currentValue) {
            const canvas = document.getElementById('trendChart');
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = canvas.offsetHeight;

            // Combine fixed history + current live value
            const dataPoints = [...historyPoints, currentValue];
            const pointCount = dataPoints.length;
            const stepX = width / (pointCount - 1);

            ctx.clearRect(0, 0, width, height);

            // Create Gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, "rgba(0, 255, 65, 0.4)");
            gradient.addColorStop(1, "rgba(0, 255, 65, 0.0)");
            
            // If risk is high, change color
            let strokeColor = '#00ff41';
            if(currentValue > 30) strokeColor = '#ffb700';
            if(currentValue > 60) strokeColor = '#ff3333';

            // Draw Area
            ctx.beginPath();
            ctx.moveTo(0, height);
            dataPoints.forEach((val, index) => {
                const x = index * stepX;
                const y = height - (val / 100 * height);
                ctx.lineTo(x, y);
            });
            ctx.lineTo(width, height);
            ctx.closePath();
            ctx.fillStyle = gradient;
            ctx.fill();

            // Draw Line
            ctx.beginPath();
            ctx.strokeStyle = strokeColor;
            ctx.lineWidth = 3;
            ctx.lineJoin = 'round';
            dataPoints.forEach((val, index) => {
                const x = index * stepX;
                const y = height - (val / 100 * height);
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();

            // Draw Points
            dataPoints.forEach((val, index) => {
                const x = index * stepX;
                const y = height - (val / 100 * height);
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fillStyle = '#fff';
                ctx.fill();
            });
        }

        // --- MODAL & SHARE ---
        function openModal(type, event) {
            event.stopPropagation();
            const modal = document.getElementById('infoModal');
            const titleEl = document.getElementById('mTitle');
            const contentEl = document.getElementById('mContent');
            
            if (type === 'general') {
                titleEl.innerText = content[currentLang].m_general_title;
                contentEl.innerHTML = content[currentLang].m_general_desc;
            } else {
                titleEl.innerText = content[currentLang][`l_${type}`];
                contentEl.innerHTML = content[currentLang][`m_${type}_desc`];
            }
            modal.classList.add('open');
        }

        function closeModal(e, force = false) {
            if (force || e.target.id === 'infoModal') {
                document.getElementById('infoModal').classList.remove('open');
            }
        }

        function shareSite() {
            const url = window.location.href;
            if (navigator.share) {
                navigator.share({ title: 'WARADAR', text: 'Risk Score: ' + document.getElementById('mainScore').innerText, url: url });
            } else {
                alert("Link copied!");
                navigator.clipboard.writeText(url);
            }
        }

        function setLang(lang) {
            currentLang = lang;
            document.querySelectorAll('.flag').forEach(f => f.classList.remove('active'));
            event.currentTarget.classList.add('active');
            if(lang === 'he') document.body.classList.add('rtl');
            else document.body.classList.remove('rtl');
            
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if(content[lang][key]) el.innerText = content[lang][key];
            });
            renderParams();
        }

        // Start
        updateClock();
        simulateData();
        setInterval(simulateData, 30000); 

    </script>
</body>
</html>
