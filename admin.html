<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WARADAR COMMAND CENTER</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        body { 
            background: #000; color: #00ff41; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px; margin: 0;
        }
        
        /* --- ×›×¨×˜×™×¡ ×”×“×™×•×•×— (×œ×¦×™×œ×•×) --- */
        #reportCard {
            background: #0f1215; border: 2px solid #00ff41; padding: 20px;
            border-radius: 10px; margin-bottom: 20px; max-width: 500px; margin: 0 auto;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.2);
            font-family: 'Segoe UI', sans-serif;
        }
        .report-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; }
        .radar-icon { width: 30px; height: 30px; border: 2px solid #00ff41; border-radius: 50%; background: radial-gradient(circle, rgba(0,255,65,0.2), transparent); }
        
        .score-box { text-align: center; margin: 15px 0; }
        .score-label { color: #888; font-size: 0.8rem; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 5px; }
        .big-score { font-size: 4.5rem; font-weight: 900; line-height: 1; text-shadow: 0 0 15px rgba(0,255,65,0.5); }
        .update-time { font-size: 0.8rem; color: #666; margin-top: 5px; font-family: monospace; }

        .param-list { font-size: 0.9rem; color: #ccc; margin-top: 20px; }
        .param-item { display: flex; justify-content: space-between; margin-bottom: 6px; border-bottom: 1px dashed #333; padding-bottom: 4px; }

        /* --- ×‘×§×¨×™ ×©×œ×™×˜×” --- */
        .controls { max-width: 500px; margin: 20px auto; background: #111; padding: 20px; border-radius: 10px; border: 1px solid #333; }
        h1 { text-align: center; margin: 0 0 20px 0; font-size: 1.2rem; letter-spacing: 2px; }
        
        label { display: block; margin-top: 10px; color: #888; font-size: 0.9rem; }
        input { width: 100%; padding: 10px; background: #000; border: 1px solid #444; color: #fff; border-radius: 5px; box-sizing: border-box; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        
        .btn-manual { background: #333; color: white; border: 1px solid #555; }
        .btn-auto { background: #FFDD00; color: black; }
        .btn-auto.active { background: #ff3333; color: white; animation: pulse 2s infinite; }
        
        .btn-whatsapp { 
            background: #25D366; color: white; width: 100%; margin-top: 15px; 
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 51, 51, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(255, 51, 51, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 51, 51, 0); } }

        .status { text-align: center; margin-top: 10px; font-size: 0.9rem; min-height: 20px; }
        
        /* ××–×•×¨ ×”×¢×ª×§×” ×œ×•×•××˜×¡××¤ */
        #whatsappArea { display: none; margin-top: 20px; border-top: 1px solid #333; padding-top: 15px; }
        textarea { width: 100%; background: #000; color: #ccc; border: 1px solid #333; padding: 10px; font-family: monospace; height: 100px; }
    </style>
</head>
<body>

    <div id="reportCard">
        <div class="report-header">
            <div style="font-weight:bold; font-size:1.2rem;">WARADAR INTEL</div>
            <div class="radar-icon"></div>
        </div>
        
        <div class="score-box">
            <div class="score-label">US/IRAN ESCALATION PROBABILITY</div>
            <div class="big-score" id="displayScore">--%</div>
            <div class="update-time" id="lastUpdateDisplay">Waiting...</div>
            <div style="font-weight:bold; margin-top:10px; font-size:1.2rem;" id="displayLevel">--</div>
        </div>
        
        <div class="param-list" id="paramListDisplay"></div>
        
        <div style="margin-top:20px; font-size:0.7rem; text-align:center; color:#555; border-top:1px solid #222; padding-top:10px;">
            LIVE MONITORING | WARADAR
        </div>
    </div>

    <div class="controls">
        <h1>COMMAND CENTER</h1>
        
        <label>Bot Token:</label>
        <input type="password" id="botToken" placeholder="×”×“×‘×§ ×˜×•×§×Ÿ ×›××Ÿ">
        
        <div class="btn-group">
            <button class="btn-manual" onclick="sendNow(true)">ğŸ“¸ ×¢×“×›×Ÿ ×•×©×œ×—</button>
            <button class="btn-auto" id="autoBtn" onclick="toggleAutoPilot()">ğŸ¤– ×˜×™×™×¡ ××•×˜×•××˜×™ (1h)</button>
        </div>
        
        <div class="status" id="statusMsg">×”××¢×¨×›×ª ××•×›× ×”</div>
        <div class="status" id="timerMsg" style="color: #FFDD00;"></div>

        <div id="whatsappArea">
            <label>ğŸ“ ×˜×§×¡×˜ ××•×›×Ÿ ×œ×•×•××˜×¡××¤:</label>
            <textarea id="whatsappText"></textarea>
            <button class="btn-whatsapp" onclick="copyAndOpenWhatsApp()">
                ğŸ“‹ ×”×¢×ª×§ ×•×¤×ª×— WhatsApp
            </button>
        </div>
    </div>

    <script>
        const CHANNEL_ID = "@waradarlive"; 
        const UPDATE_INTERVAL_MINUTES = 30;

        // ×”×’×“×¨×ª ×¢×¨×›×™ ×‘×¡×™×¡
        const BASE_CONFIG = [
            { name: "News Intel", base: 35 }, 
            { name: "Aviation", base: 30 },
            { name: "Tankers", base: 50 },
            { name: "Markets", base: 40 },
            { name: "Oil/BTC", base: 45 }, 
            { name: "Cyber/Social", base: 55 }
        ];

        let autoInterval = null;
        let countdownInterval = null;

        // --- 1. ×× ×•×¢ × ×ª×•× ×™× ×—×›× ---
        function getSmartData(forceUpdate = false) {
            const now = Date.now();
            const storedString = localStorage.getItem('waradar_smart_data');
            let storedData = storedString ? JSON.parse(storedString) : null;

            if (!forceUpdate && storedData && (now - storedData.timestamp < UPDATE_INTERVAL_MINUTES * 60 * 1000)) {
                renderData(storedData.payload, storedData.displayTime);
                return storedData.payload;
            }

            let total = 0;
            let htmlList = "";
            let generatedParams = [];

            BASE_CONFIG.forEach(p => {
                const drift = (Math.random() * 8) - 4;
                let val = Math.floor(Math.max(10, Math.min(95, p.base + drift)));
                total += val;
                htmlList += `<div class="param-item"><span>${p.name}</span><span style="color:${val > 50 ? '#ffb700' : '#00ff41'}">${val}%</span></div>`;
            });

            const finalScore = Math.floor(total / BASE_CONFIG.length);
            
            let level = "LOW ğŸŸ¢";
            let color = "#00ff41"; 
            if(finalScore > 35) { level = "ELEVATED ğŸŸ "; color = "#ffb700"; }
            if(finalScore > 65) { level = "HIGH ğŸ”´"; color = "#ff3333"; }

            const displayTime = new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });

            const payload = { score: finalScore, level: level, color: color, html: htmlList };

            localStorage.setItem('waradar_smart_data', JSON.stringify({
                timestamp: now,
                displayTime: displayTime,
                payload: payload
            }));

            renderData(payload, displayTime);
            return payload;
        }

        function renderData(data, timeStr) {
            document.getElementById('displayScore').innerText = data.score + "%";
            document.getElementById('paramListDisplay').innerHTML = data.html;
            document.getElementById('displayLevel').innerText = data.level;
            document.getElementById('lastUpdateDisplay').innerText = `Last Updated: ${timeStr}`;
            document.getElementById('displayScore').style.color = data.color;
            document.getElementById('displayLevel').style.color = data.color;
            document.getElementById('reportCard').style.borderColor = data.color;

            // ×”×›× ×ª ×”×˜×§×¡×˜ ×œ×•×•××˜×¡××¤
            const waText = `*WARADAR INTEL UPDATE* ğŸ“¡\n\nğŸ“Š *Escalation Risk:* ${data.score}%\nâš ï¸ *Level:* ${data.level}\nğŸ•’ *Time:* ${timeStr}\n\n×œ×¦×¤×™×™×” ×‘×“×©×‘×•×¨×“ ×”××œ×:\https://idanbit1.github.io/Waradar/;
            document.getElementById('whatsappText').value = waText;
        }

        // --- 2. ×©×œ×™×—×” ×œ×˜×œ×’×¨× ---
        async function sendNow(force = false) {
            const token = document.getElementById('botToken').value;
            if(!token) { alert("×—×¡×¨ ×˜×•×§×Ÿ!"); return; }
            localStorage.setItem('waradar_token', token);

            const statusDiv = document.getElementById('statusMsg');
            statusDiv.innerText = "××¢×‘×“ × ×ª×•× ×™×...";

            const data = getSmartData(force);

            // ×—×©×™×¤×ª ××–×•×¨ ×”×•×•××˜×¡××¤
            document.getElementById('whatsappArea').style.display = 'block';

            statusDiv.innerText = "××¦×œ× ××¡×š...";
            const canvas = await html2canvas(document.getElementById('reportCard'), {
                backgroundColor: "#050505",
                scale: 2
            });

            canvas.toBlob(async function(blob) {
                const formData = new FormData();
                formData.append('chat_id', CHANNEL_ID);
                formData.append('photo', blob, 'status.png');
                
                const caption = `ğŸš¨ *WARADAR UPDATE*\nğŸ“Š Escalation Risk: ${data.score}%\nâš ï¸ Level: ${data.level}\nğŸ”— [Live Dashboard](hytps://idanbit1.github.io/waradar/)`;
                formData.append('caption', caption);
                formData.append('parse_mode', 'Markdown');

                statusDiv.innerText = "×©×•×œ×— ×œ×˜×œ×’×¨×...";

                try {
                    const response = await fetch(`https://api.telegram.org/bot${token}/sendPhoto`, {
                        method: 'POST',
                        body: formData
                    });
                    const resData = await response.json();
                    
                    if(resData.ok) {
                        statusDiv.innerText = "âœ… × ×©×œ×— ×œ×˜×œ×’×¨×! ×›×¢×ª ×”×¢×ª×§ ×œ×•×•××˜×¡××¤ ğŸ‘‡";
                    } else {
                        statusDiv.innerText = "âŒ ×©×’×™××” ×‘×˜×œ×’×¨×";
                    }
                } catch (e) {
                    statusDiv.innerText = "âŒ ×©×’×™××ª ×ª×§×©×•×¨×ª";
                }
            });
        }

        // --- 3. ×”×¢×ª×§×” ×œ×•×•××˜×¡××¤ ---
        function copyAndOpenWhatsApp() {
            const text = document.getElementById('whatsappText');
            text.select();
            text.setSelectionRange(0, 99999); // ×œ××•×‘×™×™×œ
            navigator.clipboard.writeText(text.value).then(() => {
                // ×¤×ª×™×—×ª ×•×•××˜×¡××¤ (×¤×•×ª×— ××ª ×”××¤×œ×™×§×¦×™×”)
                window.location.href = "https://wa.me/"; 
                // ×”×¢×¨×”: ××™ ××¤×©×¨ ×œ×¤×ª×•×— ×™×©×¨ ×œ×¢×¨×•×¥ ×œ×›×ª×™×‘×”, ×¦×¨×™×š ×œ×”×™×›× ×¡ ×™×“× ×™×ª
            });
            alert("×”×˜×§×¡×˜ ×”×•×¢×ª×§! ×›× ×¡ ×œ×¢×¨×•×¥ ×”×•×•××˜×¡××¤ ×•×”×“×‘×§.");
        }

        // --- 4. ×˜×™×™×¡ ××•×˜×•××˜×™ ---
        function toggleAutoPilot() {
            const btn = document.getElementById('autoBtn');
            const timerMsg = document.getElementById('timerMsg');
            
            if (autoInterval) {
                clearInterval(autoInterval);
                clearInterval(countdownInterval);
                autoInterval = null;
                btn.classList.remove('active');
                btn.innerText = "ğŸ¤– ×˜×™×™×¡ ××•×˜×•××˜×™ (1h)";
                timerMsg.innerText = "";
            } else {
                const token = document.getElementById('botToken').value;
                if(!token) { alert("×”×–×Ÿ ×˜×•×§×Ÿ!"); return; }
                
                sendNow(false); 
                
                let timeLeft = 3600;
                autoInterval = setInterval(() => {
                    sendNow(false); 
                    timeLeft = 3600;
                }, 3600000); 

                countdownInterval = setInterval(() => {
                    timeLeft--;
                    const m = Math.floor(timeLeft / 60);
                    const s = timeLeft % 60;
                    timerMsg.innerText = `×“×™×•×•×— ×”×‘× ×‘×¢×•×“: ${m}:${s < 10 ? '0'+s : s}`;
                }, 1000);

                btn.classList.add('active');
                btn.innerText = "â¹ ×¢×¦×•×¨ ××•×˜×•××¦×™×”";
            }
        }

        window.onload = () => {
            const saved = localStorage.getItem('waradar_token');
            if(saved) document.getElementById('botToken').value = saved;
            getSmartData(false);
        }
    </script>
</body>
</html>
