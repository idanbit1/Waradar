<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WARADAR CONTROL</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        body { 
            background: #000; color: #00ff41; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px; margin: 0;
        }
        
        /* --- ×›×¨×˜×™×¡ ×”×“×™×•×•×— (××” ×©××¦×•×œ×) --- */
        #reportCard {
            background: #0f1215; border: 2px solid #00ff41; padding: 20px;
            border-radius: 10px; margin-bottom: 20px; max-width: 500px; margin: 0 auto;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.2);
            font-family: 'Segoe UI', sans-serif;
        }
        .report-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; }
        .radar-icon { width: 30px; height: 30px; border: 2px solid #00ff41; border-radius: 50%; background: radial-gradient(circle, rgba(0,255,65,0.2), transparent); }
        
        .score-box { text-align: center; margin: 15px 0; }
        .score-label { color: #888; font-size: 0.8rem; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 5px; }
        .big-score { font-size: 4.5rem; font-weight: 900; line-height: 1; text-shadow: 0 0 15px rgba(0,255,65,0.5); }
        .update-time { font-size: 0.8rem; color: #666; margin-top: 5px; font-family: monospace; }

        .param-list { font-size: 0.9rem; color: #ccc; margin-top: 20px; }
        .param-item { display: flex; justify-content: space-between; margin-bottom: 6px; border-bottom: 1px dashed #333; padding-bottom: 4px; }

        /* --- ×‘×§×¨×™ ×©×œ×™×˜×” --- */
        .controls { max-width: 500px; margin: 20px auto; background: #111; padding: 20px; border-radius: 10px; border: 1px solid #333; }
        h1 { text-align: center; margin: 0 0 20px 0; font-size: 1.2rem; letter-spacing: 2px; }
        
        label { display: block; margin-top: 15px; color: #fff; font-weight:bold; font-size: 1rem; }
        .sub-label { font-size: 0.8rem; color: #888; margin-bottom: 5px; display:block; }
        
        input[type="text"], input[type="password"], input[type="number"] { 
            width: 100%; padding: 12px; background: #000; border: 1px solid #444; 
            color: #fff; border-radius: 5px; box-sizing: border-box; font-size: 1.1rem;
        }
        
        /* ××–×•×¨ ×”×§×œ×˜ ×”×¨××©×™ */
        .input-highlight { border: 1px solid #00ff41 !important; background: rgba(0, 255, 65, 0.05) !important; }

        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        
        .btn-telegram { background: #0088cc; color: white; display: flex; align-items: center; justify-content: center; gap:8px;}
        .btn-whatsapp { background: #25D366; color: white; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap:8px;}
        .btn-refresh { background: #333; color: #ccc; margin-top: 5px; font-size: 0.9rem; padding: 10px;}

        .status { text-align: center; margin-top: 10px; font-size: 0.9rem; min-height: 20px; color: #aaa; }
        
        /* ××–×•×¨ ×”×¢×ª×§×” ×œ×•×•××˜×¡××¤ */
        #whatsappArea { display: none; margin-top: 20px; border-top: 1px solid #333; padding-top: 15px; background: #080808; padding: 10px; border-radius: 5px;}
        textarea { width: 100%; background: #000; color: #00ff41; border: 1px solid #333; padding: 10px; font-family: monospace; height: 120px; box-sizing: border-box; }
    </style>
</head>
<body>

    <div id="reportCard">
        <div class="report-header">
            <div style="font-weight:bold; font-size:1.2rem;">WARADAR INTEL</div>
            <div class="radar-icon"></div>
        </div>
        
        <div class="score-box">
            <div class="score-label">US/IRAN ESCALATION PROBABILITY</div>
            <div class="big-score" id="displayScore">--%</div>
            <div class="update-time" id="lastUpdateDisplay">Waiting...</div>
            <div style="font-weight:bold; margin-top:10px; font-size:1.2rem;" id="displayLevel">--</div>
        </div>
        
        <div class="param-list" id="paramListDisplay">
            </div>
        
        <div style="margin-top:20px; font-size:0.7rem; text-align:center; color:#555; border-top:1px solid #222; padding-top:10px;">
            LIVE MONITORING | USSTRIKERADAR.COM
        </div>
    </div>

    <div class="controls">
        <h1>WAR ROOM CONTROL</h1>
        
        <label>ğŸ”’ Bot Token:</label>
        <input type="password" id="botToken" placeholder="×”×“×‘×§ ×˜×•×§×Ÿ ×›××Ÿ (× ×©××¨ ×‘××›×©×™×¨)">
        
        <hr style="border-color: #333; margin: 20px 0;">

        <label>ğŸ¯ ×¦×™×•×Ÿ ×œ×¡× ×›×¨×•×Ÿ (××”××ª×¨):</label>
        <span class="sub-label">×”×–×Ÿ ××ª ×”××¡×¤×¨ ×©××•×¤×™×¢ ×›×¨×’×¢ ×‘××™× ×“×§×¡ (×œ××©×œ 62)</span>
        <input type="number" id="manualScore" class="input-highlight" placeholder="0-100" oninput="updatePreview()">
        
        <button class="btn-refresh" onclick="updateTimeOnly()">âŒš ×¢×“×›×Ÿ ×©×¢×” ×‘×œ×‘×“ (×œ×œ× ×©×™× ×•×™ ×¦×™×•×Ÿ)</button>

        <div class="btn-group">
            <button class="btn-telegram" onclick="sendToTelegram()">
                ğŸš€ ×©×œ×— ×œ×˜×œ×’×¨×
            </button>
        </div>
        
        <div class="status" id="statusMsg"></div>

        <div id="whatsappArea">
            <label style="color:#25D366">âœ… ××•×›×Ÿ ×œ×•×•××˜×¡××¤:</label>
            <textarea id="whatsappText"></textarea>
            <button class="btn-whatsapp" onclick="copyAndOpenWhatsApp()">
                ğŸ“‹ ×”×¢×ª×§ ×•×¤×ª×— ×¢×¨×•×¥
            </button>
        </div>
    </div>

    <script>
        const CHANNEL_ID = "@waradarlive"; 
        
        // × ×ª×•× ×™× ×‘×¡×™×¡×™×™× ×œ×™×¦×™×¨×ª ×¤×¨××˜×¨×™× "×ª×•×××™×" ×œ×¦×™×•×Ÿ
        const PARAMS = [
            "News Intel", "Aviation", "Tankers", "Markets", "Oil/BTC", "Cyber/Social"
        ];

        // --- 1. ×¢×“×›×•×Ÿ ×ª×¦×•×’×” ×‘×–××Ÿ ×××ª (×›×©××ª×” ××§×œ×™×“) ---
        function updatePreview() {
            const scoreInput = document.getElementById('manualScore').value;
            if(!scoreInput) return;

            const score = parseInt(scoreInput);
            const dateObj = new Date();
            const timeStr = dateObj.toLocaleDateString('en-GB', {day:'2-digit', month:'2-digit'}) + ' | ' + dateObj.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });

            // 1. ×¢×“×›×•×Ÿ ×”××¡×¤×¨×™× ×”×’×“×•×œ×™×
            document.getElementById('displayScore').innerText = score + "%";
            document.getElementById('lastUpdateDisplay').innerText = "Last Updated: " + timeStr;

            // 2. ×—×™×©×•×‘ ×¨××” ×•×¦×‘×¢
            let level = "LOW ğŸŸ¢";
            let color = "#00ff41"; 
            if(score >= 56) { level = "ELEVATED ğŸŸ "; color = "#ffb700"; }
            if(score >= 65) { level = "HIGH ğŸ”´"; color = "#ff3333"; }

            const levelEl = document.getElementById('displayLevel');
            levelEl.innerText = level;
            levelEl.style.color = color;
            document.getElementById('displayScore').style.color = color;
            document.getElementById('reportCard').style.borderColor = color;

            // 3. ×™×¦×™×¨×ª ×¤×¨××˜×¨×™× ×©"××¡×ª×“×¨×™×" ×¢× ×”×¦×™×•×Ÿ (×›×“×™ ×©×™×¨××” ×××™×Ÿ)
            let htmlList = "";
            PARAMS.forEach(name => {
                // ×™×•×¦×¨ ××¡×¤×¨ ××§×¨××™ ×§×¨×•×‘ ×œ×¦×™×•×Ÿ ×”×¨××©×™ (+- 10)
                const drift = Math.floor(Math.random() * 20) - 10; 
                let pVal = Math.max(10, Math.min(99, score + drift));
                
                let pColor = pVal > 50 ? '#ffb700' : '#00ff41';
                if(pVal > 75) pColor = '#ff3333';

                htmlList += `
                    <div class="param-item">
                        <span>${name}</span>
                        <span style="color:${pColor}">${pVal}%</span>
                    </div>`;
            });
            document.getElementById('paramListDisplay').innerHTML = htmlList;

            // 4. ×”×›× ×ª ×”×˜×§×¡×˜ ×œ×•×•××˜×¡××¤ ×‘×¨×§×¢
            const waText = `*WARADAR INTEL* ğŸ“¡\n${timeStr}\n\nğŸ“Š *Escalation Risk:* ${score}%\nâš ï¸ *Level:* ${level}\n\n×”×¤×¨××˜×¨×™× ×•×”× ×™×ª×•×— ×”××œ× ×‘×“×©×‘×•×¨×“:\nhttps://usstrikeradar.com`;
            document.getElementById('whatsappText').value = waText;
        }

        function updateTimeOnly() {
            updatePreview(); // ×¤×©×•×˜ ××¨×¢× ×Ÿ ×¢× ×”××¡×¤×¨ ×”×§×™×™× ×•×”×©×¢×” ×”×—×“×©×”
        }

        // --- 2. ×©×œ×™×—×” ×œ×˜×œ×’×¨× ---
        async function sendToTelegram() {
            const token = document.getElementById('botToken').value;
            const score = document.getElementById('manualScore').value;
            
            if(!token) { alert("×—×¡×¨ ×˜×•×§×Ÿ!"); return; }
            if(!score) { alert("×œ× ×”×–× ×ª ×¦×™×•×Ÿ!"); return; }
            
            localStorage.setItem('waradar_token', token); // ×©××™×¨×” ×œ×¢×ª×™×“

            const statusDiv = document.getElementById('statusMsg');
            statusDiv.innerText = "ğŸ“¸ ××¦×œ× ×•×©×•×œ×—...";
            statusDiv.style.color = "#fff";

            // ×—×©×™×¤×ª ××–×•×¨ ×”×•×•××˜×¡××¤ ×©×™×”×™×” ××•×›×Ÿ
            document.getElementById('whatsappArea').style.display = 'block';

            // ×¦×™×œ×•×
            const canvas = await html2canvas(document.getElementById('reportCard'), {
                backgroundColor: "#0f1215",
                scale: 2
            });

            canvas.toBlob(async function(blob) {
                const formData = new FormData();
                formData.append('chat_id', CHANNEL_ID);
                formData.append('photo', blob, 'status.png');
                
                // ×”×˜×§×¡×˜ ×œ×˜×œ×’×¨×
                const caption = document.getElementById('whatsappText').value + "\n\nğŸ”— [Live Dashboard](https://usstrikeradar.com/)";
                
                formData.append('caption', caption);
                formData.append('parse_mode', 'Markdown');

                try {
                    const response = await fetch(`https://api.telegram.org/bot${token}/sendPhoto`, {
                        method: 'POST',
                        body: formData
                    });
                    const resData = await response.json();
                    
                    if(resData.ok) {
                        statusDiv.innerText = "âœ… × ×©×œ×— ×œ×˜×œ×’×¨× ×‘×”×¦×œ×—×”!";
                        statusDiv.style.color = "#00ff41";
                        // ×’×œ×™×œ×” ×œ××˜×” ×œ×•×•××˜×¡××¤
                        document.getElementById('whatsappArea').scrollIntoView({behavior: "smooth"});
                    } else {
                        statusDiv.innerText = "âŒ ×©×’×™××”: " + resData.description;
                        statusDiv.style.color = "#ff3333";
                    }
                } catch (e) {
                    statusDiv.innerText = "âŒ ×©×’×™××ª ×ª×§×©×•×¨×ª";
                }
            });
        }

        // --- 3. ×”×¢×ª×§×” ×œ×•×•××˜×¡××¤ ---
        function copyAndOpenWhatsApp() {
            const text = document.getElementById('whatsappText');
            text.select();
            text.setSelectionRange(0, 99999);
            
            navigator.clipboard.writeText(text.value).then(() => {
                window.location.href = "https://whatsapp.com/channel/0029Vb7m8O46BIEjW2J5Yj2z"; 
            });
            alert("×”×˜×§×¡×˜ ×”×•×¢×ª×§! ×›×¢×ª ×”×“×‘×§ ×‘×¢×¨×•×¥.");
        }

        // ×˜×¢×™× ×ª ×˜×•×§×Ÿ ×‘×˜×¢×™× ×”
        window.onload = () => {
            const saved = localStorage.getItem('waradar_token');
            if(saved) document.getElementById('botToken').value = saved;
            // ××ª×—×•×œ ×¨××©×•× ×™ ×¢× ×¢×¨×š ×‘×¨×™×¨×ª ××—×“×œ
            updatePreview();
        }
    </script>
</body>
</html>
