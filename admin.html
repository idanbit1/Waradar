<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WARADAR COMMAND CENTER</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        body { 
            background: #000; color: #00ff41; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px; margin: 0;
        }
        
        /* --- ×¢×™×¦×•×‘ ×›×¨×˜×™×¡ ×”×“×™×•×•×— (××” ×©×™×¦×•×œ× ×œ×ª××•× ×”) --- */
        #reportCard {
            background: #0f1215; border: 2px solid #00ff41; padding: 20px;
            border-radius: 10px; margin-bottom: 20px; max-width: 500px; margin: 0 auto;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.2);
        }
        .report-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; }
        .radar-icon { width: 30px; height: 30px; border: 2px solid #00ff41; border-radius: 50%; background: radial-gradient(circle, rgba(0,255,65,0.2), transparent); }
        .big-score { font-size: 4rem; font-weight: 900; text-align: center; margin: 10px 0; text-shadow: 0 0 15px rgba(0,255,65,0.5); }
        .param-list { font-size: 0.9rem; color: #ccc; }
        .param-item { display: flex; justify-content: space-between; margin-bottom: 5px; border-bottom: 1px dashed #333; padding-bottom: 2px; }

        /* --- ×‘×§×¨×™ ×©×œ×™×˜×” --- */
        .controls { max-width: 500px; margin: 20px auto; background: #111; padding: 20px; border-radius: 10px; border: 1px solid #333; }
        h1 { text-align: center; margin: 0 0 20px 0; font-size: 1.2rem; letter-spacing: 2px; }
        
        label { display: block; margin-top: 10px; color: #888; font-size: 0.9rem; }
        input, select { width: 100%; padding: 10px; background: #000; border: 1px solid #444; color: #fff; border-radius: 5px; box-sizing: border-box; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 15px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 1rem; }
        
        .btn-manual { background: #333; color: white; border: 1px solid #555; }
        .btn-auto { background: #FFDD00; color: black; }
        .btn-auto.active { background: #ff3333; color: white; animation: pulse 2s infinite; }
        
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255, 51, 51, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(255, 51, 51, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 51, 51, 0); } }

        .status { text-align: center; margin-top: 10px; font-size: 0.9rem; min-height: 20px; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="reportCard">
        <div class="report-header">
            <div style="font-weight:bold; font-size:1.2rem;">WARADAR INTEL</div>
            <div class="radar-icon"></div>
        </div>
        <div style="text-align:center; color:#ffb700; letter-spacing:1px; margin-bottom:5px;">CURRENT RISK PROBABILITY</div>
        <div class="big-score" id="displayScore">65%</div>
        <div style="text-align:center; font-weight:bold; margin-bottom:20px; color:#ff3333;" id="displayLevel">HIGH ğŸ”´</div>
        
        <div class="param-list" id="paramListDisplay">
            </div>
        <div style="margin-top:15px; font-size:0.7rem; text-align:center; color:#666;">
            LIVE MONITORING | USSTRIKERADAR.COM
        </div>
    </div>

    <div class="controls">
        <h1>COMMAND CENTER</h1>
        
        <label>Bot Token:</label>
        <input type="password" id="botToken" placeholder="×”×“×‘×§ ×˜×•×§×Ÿ ×›××Ÿ">
        
        <div class="btn-group">
            <button class="btn-manual" onclick="sendNow()">ğŸ“¸ ×¦×œ× ×•×©×œ×— ×™×“× ×™</button>
            <button class="btn-auto" id="autoBtn" onclick="toggleAutoPilot()">ğŸ¤– ×”×¤×¢×œ ×˜×™×™×¡ ××•×˜×•××˜×™ (1h)</button>
        </div>

        <div class="status" id="statusMsg">××•×›×Ÿ ×œ×¤×¢×•×œ×”</div>
        <div class="status" id="timerMsg" style="color: #FFDD00;"></div>
    </div>

    <script>
        const CHANNEL_ID = "@waradarlive"; // ×•×•×“× ×©×–×” ×©× ×”×¢×¨×•×¥ ×©×œ×š
        let autoInterval = null;
        let countdownInterval = null;

        // --- 1. ×¡×™××•×œ×¦×™×™×ª × ×ª×•× ×™× (××•×ª×• ×× ×•×¢ ×›××• ×‘××ª×¨) ---
        function simulateData() {
            const params = [
                { name: "News Intel", val: 45 }, { name: "Aviation", val: 30 },
                { name: "Tankers", val: 65 }, { name: "Markets", val: 55 },
                { name: "Oil/BTC", val: 60 }, { name: "Cyber/Social", val: 70 }
            ];
            
            let total = 0;
            let htmlList = "";

            params.forEach(p => {
                const flux = (Math.random() * 10) - 5;
                let val = Math.floor(Math.max(0, Math.min(100, p.val + flux)));
                total += val;
                
                // ×¢×™×¦×•×‘ ×”×¨×©×™××” ×œ×¦×™×œ×•×
                htmlList += `
                    <div class="param-item">
                        <span>${p.name}</span>
                        <span style="color:${val > 50 ? '#ffb700' : '#00ff41'}">${val}%</span>
                    </div>
                `;
            });

            const finalScore = Math.floor(total / params.length);
            
            // ×¢×“×›×•×Ÿ ×”×ª×¦×•×’×” ×”×’×¨×¤×™×ª
            document.getElementById('displayScore').innerText = finalScore + "%";
            document.getElementById('paramListDisplay').innerHTML = htmlList;
            
            let level = "LOW ğŸŸ¢";
            let color = "#00ff41";
            if(finalScore > 30) { level = "ELEVATED ğŸŸ "; color = "#ffb700"; }
            if(finalScore > 60) { level = "HIGH ğŸ”´"; color = "#ff3333"; }
            
            const levelEl = document.getElementById('displayLevel');
            levelEl.innerText = level;
            levelEl.style.color = color;
            document.getElementById('displayScore').style.color = color;
            document.getElementById('reportCard').style.borderColor = color;

            return { score: finalScore, level: level };
        }

        // --- 2. ×¤×•× ×§×¦×™×™×ª ×¦×™×œ×•× ×•×©×œ×™×—×” ×œ×˜×œ×’×¨× ---
        async function sendNow() {
            const token = document.getElementById('botToken').value;
            if(!token) { alert("×—×¡×¨ ×˜×•×§×Ÿ!"); return; }
            localStorage.setItem('waradar_token', token); // ×©××™×¨×” ×œ×¢×ª×™×“

            const statusDiv = document.getElementById('statusMsg');
            statusDiv.innerText = "××¢×‘×“ × ×ª×•× ×™× ×•××¦×œ× ××¡×š...";

            // 1. ×¨×¢× ×•×Ÿ × ×ª×•× ×™×
            const data = simulateData();

            // 2. ×¦×™×œ×•× ×”-DIV ×©× ×§×¨× reportCard
            const canvas = await html2canvas(document.getElementById('reportCard'), {
                backgroundColor: "#050505",
                scale: 2 // ××™×›×•×ª ×’×‘×•×”×”
            });

            // 3. ×”××¨×” ×œ×§×•×‘×¥ ×•×©×œ×™×—×”
            canvas.toBlob(async function(blob) {
                const formData = new FormData();
                formData.append('chat_id', CHANNEL_ID);
                formData.append('photo', blob, 'status.png');
                
                // ×”×˜×§×¡×˜ ×©×™×ª×œ×•×•×” ×œ×ª××•× ×”
                const caption = `ğŸš¨ *WARADAR AUTO-UPDATE*\nğŸ“Š Score: ${data.score}%\nâš ï¸ Level: ${data.level}\nğŸ”— [Live Dashboard](https://idanbit1.github.io/Waradar/)`;
                formData.append('caption', caption);
                formData.append('parse_mode', 'Markdown');

                statusDiv.innerText = "×©×•×œ×— ×œ×˜×œ×’×¨×...";

                try {
                    const response = await fetch(`https://api.telegram.org/bot${token}/sendPhoto`, {
                        method: 'POST',
                        body: formData
                    });
                    const resData = await response.json();
                    
                    if(resData.ok) {
                        statusDiv.innerText = "âœ… × ×©×œ×— ×‘×”×¦×œ×—×”: " + new Date().toLocaleTimeString();
                    } else {
                        statusDiv.innerText = "âŒ ×©×’×™××”: " + resData.description;
                    }
                } catch (e) {
                    statusDiv.innerText = "âŒ ×©×’×™××ª ×ª×§×©×•×¨×ª";
                }
            });
        }

        // --- 3. ×˜×™×™×¡ ××•×˜×•××˜×™ ---
        function toggleAutoPilot() {
            const btn = document.getElementById('autoBtn');
            const timerMsg = document.getElementById('timerMsg');
            
            if (autoInterval) {
                // ×›×™×‘×•×™
                clearInterval(autoInterval);
                clearInterval(countdownInterval);
                autoInterval = null;
                btn.classList.remove('active');
                btn.innerText = "ğŸ¤– ×”×¤×¢×œ ×˜×™×™×¡ ××•×˜×•××˜×™ (1h)";
                timerMsg.innerText = "";
            } else {
                // ×”×¤×¢×œ×”
                const token = document.getElementById('botToken').value;
                if(!token) { alert("×™×© ×œ×”×–×™×Ÿ ×˜×•×§×Ÿ ×œ×¤× ×™ ×”×¤×¢×œ×” ××•×˜×•××˜×™×ª"); return; }
                
                sendNow(); // ×©×œ×™×—×” ×¨××©×•× ×” ××™×™×“×™×ª
                
                // ×˜×™×™××¨ ×œ×©×¢×” (3600000 ××™×œ×™×©× ×™×•×ª)
                let timeLeft = 3600; // ×©× ×™×•×ª
                
                autoInterval = setInterval(() => {
                    sendNow();
                    timeLeft = 3600; // ××™×¤×•×¡ ×˜×™×™××¨
                }, 3600000);

                // ×˜×™×™××¨ ×•×™×–×•××œ×™ ×œ××¡×š
                countdownInterval = setInterval(() => {
                    timeLeft--;
                    const m = Math.floor(timeLeft / 60);
                    const s = timeLeft % 60;
                    timerMsg.innerText = `×¢×“×›×•×Ÿ ×”×‘× ×‘×¢×•×“: ${m}:${s < 10 ? '0'+s : s}`;
                }, 1000);

                btn.classList.add('active');
                btn.innerText = "â¹ ×¢×¦×•×¨ ×˜×™×™×¡ ××•×˜×•××˜×™";
            }
        }

        // ×˜×¢×™× ×ª ×˜×•×§×Ÿ ×‘×˜×¢×™× ×”
        window.onload = () => {
            const saved = localStorage.getItem('waradar_token');
            if(saved) document.getElementById('botToken').value = saved;
            simulateData(); // ×”×¦×’×” ×¨××©×•× ×™×ª
        }
    </script>
</body>
</html>
